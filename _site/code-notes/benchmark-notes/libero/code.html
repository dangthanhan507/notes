<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/blog/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/blog/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > ul > li:not(:nth-child(2)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(5) > ul > li:nth-child(2) > ul > li:nth-child(2) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(1) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(5) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(5) > ul > li:nth-child(2) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(5) > ul > li:nth-child(2) > ul > li:nth-child(2) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(5) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(5) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(5) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list { display: block; } </style> <script src="/blog/assets/js/vendor/lunr.min.js"></script> <script src="/blog/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Code | Notes</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="Code" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Just messing around right now" /> <meta property="og:description" content="Just messing around right now" /> <link rel="canonical" href="http://localhost:4000/blog/code-notes/benchmark-notes/libero/code.html" /> <meta property="og:url" content="http://localhost:4000/blog/code-notes/benchmark-notes/libero/code.html" /> <meta property="og:site_name" content="Notes" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Code" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Just messing around right now","headline":"Code","url":"http://localhost:4000/blog/code-notes/benchmark-notes/libero/code.html"}</script> <!-- End Jekyll SEO tag --> <link rel="icon" href="data:,"> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_CHTML"> </script> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/blog/" class="site-title lh-tight"> Notes </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Code Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/" class="nav-list-link">Code Notes</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/code-notes/how-to-pdb.html" class="nav-list-link">How-to PDB</a></li><li class="nav-list-item"><a href="/blog/code-notes/how-to-tmux.html" class="nav-list-link">How-to Tmux</a></li><li class="nav-list-item"><a href="/blog/code-notes/distributed-dl.html" class="nav-list-link">Distributed Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/image-augmentation.html" class="nav-list-link">Image Augmentation (Torchvision)</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Benchmarks category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/benchmark-notes/" class="nav-list-link">Benchmarks</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Robocasa category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/benchmark-notes/robocasa/" class="nav-list-link">Robocasa</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/code-notes/benchmark-notes/robocasa/paper.html" class="nav-list-link">Paper</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Libero category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/benchmark-notes/libero/" class="nav-list-link">Libero</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/code-notes/benchmark-notes/libero/paper.html" class="nav-list-link">Paper</a></li><li class="nav-list-item"><a href="/blog/code-notes/benchmark-notes/libero/code.html" class="nav-list-link">Code</a></li></ul></li><li class="nav-list-item"><a href="/blog/code-notes/benchmark-notes/robomimic.html" class="nav-list-link">Robomimic</a></li></ul></li><li class="nav-list-item"><a href="/blog/code-notes/python-env.html" class="nav-list-link">Python Environments</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in GROOT category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/groot/" class="nav-list-link">GROOT</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/code-notes/groot/code.html" class="nav-list-link">Code</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Isaac category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/isaac/" class="nav-list-link">Isaac</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/code-notes/isaac/setup.html" class="nav-list-link">Isaac Setup</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/doc_notes.html" class="nav-list-link">Isaac Gym Doc Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/gymenv-obs.html" class="nav-list-link">IsaacGymEnv Obs Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/gymenv-cam.html" class="nav-list-link">IsaacGymEnv Camera Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/gymenv-network.html" class="nav-list-link">IsaacGymEnv Network Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/gymenv-tacsl.html" class="nav-list-link">IsaacGymEnv Tacsl Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/gymenv-assets.html" class="nav-list-link">IsaacGymEnv Assets Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/gymenv-env.html" class="nav-list-link">IsaacGymEnv Env Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/gymenv-task.html" class="nav-list-link">IsaacGymEnv Task Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/rl_games_integration.html" class="nav-list-link">RL Games Coupling</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/setup_isaacgymenvs.html" class="nav-list-link">IsaacGymEnvs Setup</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Cluster Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/cluster-notes/" class="nav-list-link">Cluster Notes</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/code-notes/cluster-notes/great-lakes.html" class="nav-list-link">Great Lakes Cluster</a></li><li class="nav-list-item"><a href="/blog/code-notes/cluster-notes/slurm-interactive.html" class="nav-list-link">SLURM Interactive</a></li><li class="nav-list-item"><a href="/blog/code-notes/cluster-notes/slurm.html" class="nav-list-link">SLURM</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Isaac Lab category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/isaaclab/" class="nav-list-link">Isaac Lab</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/code-notes/isaaclab/setup.html" class="nav-list-link">Isaac Lab Setup</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaaclab/isaacsim-start.html" class="nav-list-link">Isaac Sim Python Start</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaaclab/isaacsim-hello-world.html" class="nav-list-link">IsaacSim Core (Hello World)</a></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Conference Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/conference-notes/" class="nav-list-link">Conference Notes</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in ICRA 2025 category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/conference-notes/icra-2025/" class="nav-list-link">ICRA 2025</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/workshop/beyond-pick-place.html" class="nav-list-link">Beyond Pick and Place Workshop</a></li><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/workshop/contact-rich.html" class="nav-list-link">Contact Rich Workshop</a></li><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/workshop/handy.html" class="nav-list-link">Handy Workshop</a></li><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/homework.html" class="nav-list-link">Homework</a></li><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/keynote-manipulation.html" class="nav-list-link">Manipulation Keynote</a></li><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/keynote-opt.html" class="nav-list-link">Optimization Control Keynote</a></li><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/workshop/neuro-symbolic.html" class="nav-list-link">Neuro-Symbolic Workshop</a></li><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/workshop/space.html" class="nav-list-link">Space Workshop</a></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Class Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/class-notes/" class="nav-list-link">Class Notes</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in MATH 658: Geometric Mechanics category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/class-notes/00-Geometric-Mechanics/" class="nav-list-link">MATH 658: Geometric Mechanics</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in 658-Lectures category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/class-notes/00-Geometric-Mechanics/Lectures/" class="nav-list-link">658-Lectures</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/class-notes/00-Geometric-Mechanics/Lectures/08-27.html" class="nav-list-link">August 27</a></li><li class="nav-list-item"><a href="/blog/class-notes/00-Geometric-Mechanics/Lectures/09-03.html" class="nav-list-link">September 3</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Textbook category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/class-notes/00-Geometric-Mechanics/Textbook/" class="nav-list-link">Textbook</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/class-notes/00-Geometric-Mechanics/Textbook/diff-manifold.html" class="nav-list-link">Differentiable Manifold (2.2)</a></li><li class="nav-list-item"><a href="/blog/class-notes/00-Geometric-Mechanics/Textbook/variational-mech.html" class="nav-list-link">Variational Mechanics (1.2 - 1.3)</a></li><li class="nav-list-item"><a href="/blog/class-notes/00-Geometric-Mechanics/Textbook/vector-fields.html" class="nav-list-link">Vector Fields (2.1)</a></li></ul></li></ul></li><li class="nav-list-item"><a href="/blog/class-notes/01-Math-of-Bio-Networks/" class="nav-list-link">MATH 540: Mathematics for Biological Networks</a></li><li class="nav-list-item"><a href="/blog/class-notes/02-Online-Learning-Control/" class="nav-list-link">AEROSP 740: Online Learning for Control</a></li><li class="nav-list-item"><a href="/blog/class-notes/03-CVOPT-Control/" class="nav-list-link">ECE 598: Convex Optimization Methods in Control</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Sensorimotor Learning category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/class-notes/04-Computational-Sensorimotor-Learning/" class="nav-list-link">Sensorimotor Learning</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/class-notes/04-Computational-Sensorimotor-Learning/simple-decision.html" class="nav-list-link">1. Simple Decisions</a></li><li class="nav-list-item"><a href="/blog/class-notes/04-Computational-Sensorimotor-Learning/sequential-decision.html" class="nav-list-link">2. Sequential Decisions</a></li><li class="nav-list-item"><a href="/blog/class-notes/04-Computational-Sensorimotor-Learning/policy-grad.html" class="nav-list-link">3. Policy Gradients</a></li><li class="nav-list-item"><a href="/blog/class-notes/04-Computational-Sensorimotor-Learning/reward-function.html" class="nav-list-link">4. Reward Function</a></li><li class="nav-list-item"><a href="/blog/class-notes/04-Computational-Sensorimotor-Learning/learning-from-demo.html" class="nav-list-link">5. Learning Demos</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Unsupervised Learning category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/class-notes/05-Unsupervised-Learning/" class="nav-list-link">Unsupervised Learning</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/1_autoregressive.html" class="nav-list-link">1. Autoregressive</a></li><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/2_flow.html" class="nav-list-link">2. Flow</a></li><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/3_lvm.html" class="nav-list-link">3. Latent Variable Models</a></li><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/3a_lvm.html" class="nav-list-link">3a. LVM Papers</a></li><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/4_implicit_sample.html" class="nav-list-link">4. Implicit Models</a></li><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/5_diffusion.html" class="nav-list-link">5. Diffusion</a></li><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/5a_diffusion.html" class="nav-list-link">5a. Diffusion Papers</a></li><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/6_self_supervised.html" class="nav-list-link">6. Self-Supervised Learning</a></li></ul></li><li class="nav-list-item"><a href="/blog/class-notes/06-Flow-Matching/" class="nav-list-link">Flow Matching and Diffusion</a></li><li class="nav-list-item"><a href="/blog/class-notes/07-Deep-RL/" class="nav-list-link">Deep Reinforcement Learning</a></li><li class="nav-list-item"><a href="/blog/class-notes/08-Deep-Multitask-Learning/" class="nav-list-link">Deep Multi-Task and Meta Learning</a></li><li class="nav-list-item"><a href="/blog/class-notes/09-Algebraic-Techniques-Optimization/" class="nav-list-link">Algebraic Techniques for Optimization</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Deep Dive Ideas category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/deep-dive-notes/" class="nav-list-link">Deep Dive Ideas</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Debug Point ML category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/deep-dive-notes/debug-point-ml/" class="nav-list-link">Debug Point ML</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/deep-dive-notes/debug-point-ml/pointnet.html" class="nav-list-link">PointNet</a></li><li class="nav-list-item"><a href="/blog/deep-dive-notes/debug-point-ml/spatial-transformer.html" class="nav-list-link">Spatial Transformer Networks</a></li></ul></li><li class="nav-list-item"><a href="/blog/deep-dive-notes/limit-surface/" class="nav-list-link">Limit Surface Planner</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Tactile RL Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/deep-dive-notes/tactile-rl-notes/" class="nav-list-link">Tactile RL Notes</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/deep-dive-notes/tactile-rl-notes/fots.html" class="nav-list-link">FOTS</a></li><li class="nav-list-item"><a href="/blog/deep-dive-notes/tactile-rl-notes/roadmap-rl.html" class="nav-list-link">Roadmap to RL</a></li><li class="nav-list-item"><a href="/blog/deep-dive-notes/tactile-rl-notes/roadmap-tactile-rl.html" class="nav-list-link">Roadmap to Tactile RL</a></li><li class="nav-list-item"><a href="/blog/deep-dive-notes/tactile-rl-notes/sim2real-tactile-rl.html" class="nav-list-link">Sim2real Tactile RL</a></li><li class="nav-list-item"><a href="/blog/deep-dive-notes/tactile-rl-notes/tacsl.html" class="nav-list-link">TacSL</a></li><li class="nav-list-item"><a href="/blog/deep-dive-notes/tactile-rl-notes/taxim.html" class="nav-list-link">Taxim</a></li></ul></li></ul></li><li class="nav-list-item"><a href="/blog/paper-notes/" class="nav-list-link">Deep Dive Papers</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Judo Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/judo-notes/" class="nav-list-link">Judo Notes</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/judo-notes/taught.html" class="nav-list-link">Taught Moves</a></li><li class="nav-list-item"><a href="/blog/judo-notes/tolearn.html" class="nav-list-link">To Learn</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Kuka FRI Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/kuka-notes/" class="nav-list-link">Kuka FRI Notes</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/kuka-notes/code.html" class="nav-list-link">Code</a></li><li class="nav-list-item"><a href="/blog/kuka-notes/setup.html" class="nav-list-link">Setup FRI</a></li></ul></li><li class="nav-list-item"><a href="/blog/ml-git-gud-notes/" class="nav-list-link">ML (Git Gud) Resources</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in PhD Project Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/project-notes/" class="nav-list-link">PhD Project Notes</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/project-notes/hand-notes.html" class="nav-list-link">Hand Notes</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Graph Insertion category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/project-notes/project1/" class="nav-list-link">Graph Insertion</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Lit Review (Graph Insertion) category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/project-notes/project1/lit_review/" class="nav-list-link">Lit Review (Graph Insertion)</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/project-notes/project1/lit_review/robopack.html" class="nav-list-link">Robopack</a></li><li class="nav-list-item"><a href="/blog/project-notes/project1/lit_review/tactile-control-extrinsic.html" class="nav-list-link">Extrinsic Contact Control</a></li></ul></li><li class="nav-list-item"><a href="/blog/project-notes/project1/math.html" class="nav-list-link">Math Notes</a></li><li class="nav-list-item"><a href="/blog/project-notes/project1/project.html" class="nav-list-link">Point RL</a></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Prerequisites category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/prereq-notes/" class="nav-list-link">Prerequisites</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/prereq-notes/calc-variation.html" class="nav-list-link">Calculus of Variations - Chill</a></li><li class="nav-list-item"><a href="/blog/prereq-notes/calc-variation2.html" class="nav-list-link">Calculus of Variations - Serious</a></li><li class="nav-list-item"><a href="/blog/prereq-notes/groups.html" class="nav-list-link">GDL 1: Groups</a></li><li class="nav-list-item"><a href="/blog/prereq-notes/topology.html" class="nav-list-link">GDL 2: Topology</a></li><li class="nav-list-item"><a href="/blog/prereq-notes/manifolds.html" class="nav-list-link">GDL 3: Manifolds</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Quick Notes on Graphs category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/graph-notes/" class="nav-list-link">Quick Notes on Graphs</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/graph-notes/advective-diff.html" class="nav-list-link">Advective Diffusion</a></li><li class="nav-list-item"><a href="/blog/graph-notes/beyond-wl.html" class="nav-list-link">Beyond WL-test</a></li><li class="nav-list-item"><a href="/blog/graph-notes/wl-test-gnn.html" class="nav-list-link">GNN WL-test</a></li><li class="nav-list-item"><a href="/blog/graph-notes/gnn-grad-flow.html" class="nav-list-link">GNN as Gradient Flow</a></li><li class="nav-list-item"><a href="/blog/graph-notes/gnn-pde.html" class="nav-list-link">GNNs as PDEs</a></li><li class="nav-list-item"><a href="/blog/graph-notes/graph-rewiring.html" class="nav-list-link">Graph Rewiring</a></li><li class="nav-list-item"><a href="/blog/graph-notes/latent-gnn.html" class="nav-list-link">Latent GNNs</a></li><li class="nav-list-item"><a href="/blog/graph-notes/neural-sheaf-diffusion.html" class="nav-list-link">Neural Sheaf Diffusion</a></li><li class="nav-list-item"><a href="/blog/graph-notes/deep-gnn.html" class="nav-list-link">Scaling GNNs</a></li><li class="nav-list-item"><a href="/blog/graph-notes/temporal-gnn.html" class="nav-list-link">Temporal GNNs</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Notes" aria-label="Search Notes" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/blog/code-notes/">Code Notes</a></li> <li class="breadcrumb-nav-list-item"><a href="/blog/code-notes/benchmark-notes/">Benchmarks</a></li> <li class="breadcrumb-nav-list-item"><a href="/blog/code-notes/benchmark-notes/libero/">Libero</a></li> <li class="breadcrumb-nav-list-item"><span>Code</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="libero-code-notes"> <a href="#libero-code-notes" class="anchor-heading" aria-labelledby="libero-code-notes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> LIBERO Code Notes </h1> <p><b> NOTE </b>: LIBERO has no pretrained weights or checkpoints, so keep in mind I’ll have to retrain some of these architectures from scratch.</p> <p>I am going to mainly use LIBERO in this codebase, so it is important to understand not only how to use it, but also all the libraries that it uses and how they work:</p> <p>Current libraries used by LIBERO (that I’m not solid on):</p> <ul> <li><a href="https://robosuite.ai/">Robosuite</a></li> <li><a href="https://hydra.cc/docs/intro/">Hydra</a></li> <li><a href="https://wandb.ai/site">WandB</a></li> <li><a href="https://pypi.org/project/easydict/">easydict</a></li> <li><a href="https://github.com/huggingface/transformers">transformers</a></li> <li><a href="https://einops.rocks/">einops</a></li> <li><a href="https://pypi.org/project/thop/">thop</a></li> <li><a href="https://github.com/StanfordVL/bddl">bddl</a></li> </ul> <h2 id="using-libero-for-training-a-policy"> <a href="#using-libero-for-training-a-policy" class="anchor-heading" aria-labelledby="using-libero-for-training-a-policy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using LIBERO for training a policy </h2> <h3 id="1-create-config"> <a href="#1-create-config" class="anchor-heading" aria-labelledby="1-create-config"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Create Config </h3> <p>First we use hydra to interface with our configs.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">hydra</span>
<span class="kn">from</span> <span class="nn">hydra</span> <span class="kn">import</span> <span class="n">compose</span><span class="p">,</span> <span class="n">initialize</span>
<span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">OmegaConf</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">easydict</span> <span class="kn">import</span> <span class="n">EasyDict</span>

<span class="c1"># load default hydra config
</span><span class="n">hydra</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">global_hydra</span><span class="p">.</span><span class="n">GlobalHydra</span><span class="p">.</span><span class="n">instance</span><span class="p">().</span><span class="n">clear</span><span class="p">()</span>
<span class="n">initialize</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="s">'../libero/configs'</span><span class="p">)</span>
<span class="n">hydra_cfg</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="n">config_name</span><span class="o">=</span><span class="s">"config"</span><span class="p">)</span>
<span class="n">yaml_config</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="p">.</span><span class="n">to_yaml</span><span class="p">(</span><span class="n">hydra_cfg</span><span class="p">)</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="n">EasyDict</span><span class="p">(</span><span class="n">yaml</span><span class="p">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">yaml_config</span><span class="p">))</span>
</code></pre></div></div> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># LIBERO/libero/configs/config.yaml</span>
<span class="c1"># @package _global_</span>

<span class="na">defaults</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">_self_</span>
  <span class="pi">-</span> <span class="na">data</span><span class="pi">:</span> <span class="s">default</span>
  <span class="pi">-</span> <span class="na">policy</span><span class="pi">:</span> <span class="s">bc_transformer_policy</span>
  <span class="pi">-</span> <span class="na">train</span><span class="pi">:</span> <span class="s">default</span>
  <span class="pi">-</span> <span class="na">eval</span><span class="pi">:</span> <span class="s">default</span>
  <span class="pi">-</span> <span class="na">lifelong</span><span class="pi">:</span> <span class="s">base</span>
  <span class="pi">-</span> <span class="na">test</span><span class="pi">:</span> <span class="no">null</span>

<span class="na">seed</span><span class="pi">:</span> <span class="m">10000</span>
<span class="na">use_wandb</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">wandb_project</span><span class="pi">:</span> <span class="s2">"</span><span class="s">lifelong</span><span class="nv"> </span><span class="s">learning"</span>
<span class="na">folder</span><span class="pi">:</span> <span class="no">null</span> <span class="c1"># use default path</span>
<span class="na">bddl_folder</span><span class="pi">:</span> <span class="no">null</span> <span class="c1"># use default path</span>
<span class="na">init_states_folder</span><span class="pi">:</span> <span class="no">null</span> <span class="c1"># use default path</span>
<span class="na">load_previous_model</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">device</span><span class="pi">:</span> <span class="s2">"</span><span class="s">cuda"</span>
<span class="na">task_embedding_format</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bert"</span>
<span class="na">task_embedding_one_hot_offset</span><span class="pi">:</span> <span class="m">1</span>
<span class="na">pretrain</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">pretrain_model_path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
<span class="na">benchmark_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">LIBERO_SPATIAL"</span>
</code></pre></div></div> <p>This config file is actually the only config that will be processed in the codebase. In order to use other models, you must modify this config file. Kinda sucks, but that’s how it is.</p> <h3 id="2-setup-config"> <a href="#2-setup-config" class="anchor-heading" aria-labelledby="2-setup-config"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Setup config </h3> <p>After creating the config, we need to continue doing some more configurations before training.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">libero.libero</span> <span class="kn">import</span> <span class="n">get_libero_path</span>

<span class="n">cfg</span><span class="p">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">get_libero_path</span><span class="p">(</span><span class="s">"datasets"</span><span class="p">)</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">bddl_folder</span> <span class="o">=</span> <span class="n">get_libero_path</span><span class="p">(</span><span class="s">"bddl_files"</span><span class="p">)</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">init_states_folder</span> <span class="o">=</span> <span class="n">get_libero_path</span><span class="p">(</span><span class="s">"init_states"</span><span class="p">)</span>
<span class="n">cfg</span><span class="p">.</span><span class="nb">eval</span><span class="p">.</span><span class="n">num_procs</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">cfg</span><span class="p">.</span><span class="nb">eval</span><span class="p">.</span><span class="n">n_eval</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">cfg</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">25</span>

<span class="n">task_order</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">task_order_index</span> <span class="c1"># can be from {0 .. 21}, default to 0,
</span></code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># LIBERO/libero/__init__.py
</span><span class="n">libero_config_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s">"LIBERO_CONFIG_PATH"</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">"~/.libero"</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">config_file</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">libero_config_path</span><span class="p">,</span> <span class="s">"config.yaml"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_libero_path</span><span class="p">(</span><span class="n">query_key</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">yaml</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="p">.</span><span class="n">FullLoader</span><span class="p">))</span>

    <span class="c1"># Give warnings in case the user needs to access the paths
</span>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[Warning]: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s"> path </span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s"> does not exist!"</span><span class="p">)</span>

    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">query_key</span> <span class="ow">in</span> <span class="n">config</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s">"Key </span><span class="si">{</span><span class="n">query_key</span><span class="si">}</span><span class="s"> not found in config file </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s">. You need to modify it. Available keys are: </span><span class="si">{</span><span class="n">config</span><span class="p">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s">"</span>
    <span class="k">return</span> <span class="n">config</span><span class="p">[</span><span class="n">query_key</span><span class="p">]</span>

</code></pre></div></div> <h3 id="3-create-benchmark-object"> <a href="#3-create-benchmark-object" class="anchor-heading" aria-labelledby="3-create-benchmark-object"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Create Benchmark Object </h3> <p>In order to access datasets and benchmark related information, we need to create this benchmark object.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">libero.libero</span> <span class="kn">import</span> <span class="n">benchmark</span> <span class="c1"># stupid way of initializing benchmark/__init__.py
</span><span class="kn">from</span> <span class="nn">libero.libero.benchmark</span> <span class="kn">import</span> <span class="n">get_benchmark</span>

<span class="n">benchmark</span> <span class="o">=</span> <span class="n">get_benchmark</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="n">benchmark_name</span><span class="p">)(</span><span class="n">task_order</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># LIBERO/libero/benchmark/__init__.py
</span><span class="kn">import</span> <span class="nn">abc</span>

<span class="n">BENCHMARK_MAPPING</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">get_benchmark</span><span class="p">(</span><span class="n">benchmark_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">BENCHMARK_MAPPING</span><span class="p">[</span><span class="n">benchmark_name</span><span class="p">.</span><span class="n">lower</span><span class="p">()]</span>

<span class="c1">## AN NOTE: this is a global dict mapping strings (as names) to Benchmark class
## which just gives relevant meta-info on the benchmark
</span><span class="k">class</span> <span class="nc">Benchmark</span><span class="p">(</span><span class="n">abc</span><span class="p">.</span><span class="n">ABC</span><span class="p">):</span>
    <span class="s">"""A Benchmark."""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_order_index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">task_embs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">task_order_index</span> <span class="o">=</span> <span class="n">task_order_index</span>

    <span class="k">def</span> <span class="nf">_make_benchmark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">task_maps</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="p">].</span><span class="n">values</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"libero_90"</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="n">tasks</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[info] using task orders </span><span class="si">{</span><span class="n">task_orders</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">task_order_index</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">task_orders</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">task_order_index</span><span class="p">]]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n_tasks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">tasks</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_num_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">n_tasks</span>

    <span class="k">def</span> <span class="nf">get_task_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">task</span><span class="p">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">tasks</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_task_problems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">task</span><span class="p">.</span><span class="n">problem</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">tasks</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_task_bddl_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">task</span><span class="p">.</span><span class="n">bddl_file</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">tasks</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_task_bddl_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">bddl_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">get_libero_path</span><span class="p">(</span><span class="s">"bddl_files"</span><span class="p">),</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">problem_folder</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bddl_file</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">bddl_file_path</span>

    <span class="k">def</span> <span class="nf">get_task_demonstration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">.</span><span class="n">n_tasks</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s">"[error] task number </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s"> is outer of range </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">n_tasks</span><span class="si">}</span><span class="s">"</span>
        <span class="c1"># this path is relative to the datasets folder
</span>        <span class="n">demo_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">problem_folder</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="si">}</span><span class="s">_demo.hdf5"</span>
        <span class="k">return</span> <span class="n">demo_path</span>

    <span class="k">def</span> <span class="nf">get_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_task_emb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">task_embs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_task_init_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">init_states_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">get_libero_path</span><span class="p">(</span><span class="s">"init_states"</span><span class="p">),</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">problem_folder</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">init_states_file</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">init_states</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">init_states_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">init_states</span>

    <span class="k">def</span> <span class="nf">set_task_embs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_embs</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">task_embs</span> <span class="o">=</span> <span class="n">task_embs</span>
</code></pre></div></div> <h3 id="4-retrieve-datasets"> <a href="#4-retrieve-datasets" class="anchor-heading" aria-labelledby="4-retrieve-datasets"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Retrieve datasets </h3> <p>Now that we hae the benchmark object, we can utilize its information along with the config to retrieve task datasets.</p> <p>For LIBERO, they use task embeddings to represent each task. This is done by using a pretrained model (e.g., BERT) to encode the task descriptions. The task embeddings are then used to condition the policy during training and evaluation. We can see it here through the <code class="language-plaintext highlighter-rouge">get_task_embs</code> function.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">libero.lifelong.datasets</span> <span class="kn">import</span> <span class="n">SequenceVLDataset</span><span class="p">,</span> <span class="n">get_dataset</span>
<span class="kn">from</span> <span class="nn">libero.lifelong.utils</span> <span class="kn">import</span> <span class="n">get_task_embs</span>
<span class="c1"># prepare datasets from the benchmark
</span><span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">descriptions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">shape_meta</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">n_tasks</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">.</span><span class="n">n_tasks</span>

<span class="c1">### AN NOTE: loop through all tasks in benchmark and retrieve their datasets
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_tasks</span><span class="p">):</span>
    <span class="c1"># currently we assume tasks from same benchmark have the same shape_meta
</span>    <span class="n">task_i_dataset</span><span class="p">,</span> <span class="n">shape_meta</span> <span class="o">=</span> <span class="n">get_dataset</span><span class="p">(</span>
            <span class="n">dataset_path</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="n">folder</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">.</span><span class="n">get_task_demonstration</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span>
            <span class="n">obs_modality</span><span class="o">=</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">obs</span><span class="p">.</span><span class="n">modality</span><span class="p">,</span>
            <span class="n">initialize_obs_utils</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">seq_len</span><span class="o">=</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">seq_len</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># add language to the vision dataset, hence we call vl_dataset
</span>    <span class="n">descriptions</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">benchmark</span><span class="p">.</span><span class="n">get_task</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">language</span><span class="p">)</span>
    <span class="n">datasets</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_i_dataset</span><span class="p">)</span>

<span class="c1">### AN NOTE: collect all datasets into a single object
</span><span class="n">task_embs</span> <span class="o">=</span> <span class="n">get_task_embs</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">descriptions</span><span class="p">)</span>
<span class="n">benchmark</span><span class="p">.</span><span class="n">set_task_embs</span><span class="p">(</span><span class="n">task_embs</span><span class="p">)</span>

<span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">SequenceVLDataset</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">emb</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">emb</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">task_embs</span><span class="p">)]</span>
<span class="n">n_demos</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">.</span><span class="n">n_demos</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">]</span>
<span class="n">n_sequences</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">.</span><span class="n">total_num_sequences</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">]</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># LIBERO/libero/lifelong/datasets.py
</span><span class="k">def</span> <span class="nf">get_dataset</span><span class="p">(</span>
    <span class="n">dataset_path</span><span class="p">,</span>
    <span class="n">obs_modality</span><span class="p">,</span>
    <span class="n">initialize_obs_utils</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">seq_len</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">frame_stack</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">filter_key</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">hdf5_cache_mode</span><span class="o">=</span><span class="s">"low_dim"</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="p">...</span> <span class="c1"># AN REDACTED
</span>    <span class="k">return</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">shape_meta</span>

<span class="k">class</span> <span class="nc">SequenceVLDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence_dataset</span><span class="p">,</span> <span class="n">task_emb</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sequence_dataset</span> <span class="o">=</span> <span class="n">sequence_dataset</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">task_emb</span> <span class="o">=</span> <span class="n">task_emb</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">n_demos</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sequence_dataset</span><span class="p">.</span><span class="n">n_demos</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">total_num_sequences</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sequence_dataset</span><span class="p">.</span><span class="n">total_num_sequences</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sequence_dataset</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">return_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sequence_dataset</span><span class="p">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">return_dict</span><span class="p">[</span><span class="s">"task_emb"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">task_emb</span>
        <span class="k">return</span> <span class="n">return_dict</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># LIBERO/libero/lifelong/utils.py
</span>
<span class="k">def</span> <span class="nf">get_task_embs</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">descriptions</span><span class="p">):</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">set_verbosity_error</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">cfg</span><span class="p">.</span><span class="n">task_embedding_format</span> <span class="o">==</span> <span class="s">"one-hot"</span><span class="p">:</span>
        <span class="c1"># offset defaults to 1, if we have pretrained another model, this offset
</span>        <span class="c1"># starts from the pretrained number of tasks + 1
</span>        <span class="n">offset</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="n">task_embedding_one_hot_offset</span>
        <span class="n">descriptions</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s">"Task </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="n">offset</span><span class="si">}</span><span class="s">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">descriptions</span><span class="p">))]</span>

    <span class="k">if</span> <span class="n">cfg</span><span class="p">.</span><span class="n">task_embedding_format</span> <span class="o">==</span> <span class="s">"bert"</span> <span class="ow">or</span> <span class="n">cfg</span><span class="p">.</span><span class="n">task_embedding_format</span> <span class="o">==</span> <span class="s">"one-hot"</span><span class="p">:</span>
        <span class="n">tz</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="p">.</span><span class="n">from_pretrained</span><span class="p">(</span>
            <span class="s">"bert-base-cased"</span><span class="p">,</span> <span class="n">cache_dir</span><span class="o">=</span><span class="n">to_absolute_path</span><span class="p">(</span><span class="s">"./bert"</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="p">.</span><span class="n">from_pretrained</span><span class="p">(</span>
            <span class="s">"bert-base-cased"</span><span class="p">,</span> <span class="n">cache_dir</span><span class="o">=</span><span class="n">to_absolute_path</span><span class="p">(</span><span class="s">"./bert"</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">tz</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">descriptions</span><span class="p">,</span>  <span class="c1"># the sentence to be encoded
</span>            <span class="n">add_special_tokens</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>  <span class="c1"># Add [CLS] and [SEP]
</span>            <span class="n">max_length</span><span class="o">=</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">max_word_len</span><span class="p">,</span>  <span class="c1"># maximum length of a sentence
</span>            <span class="n">padding</span><span class="o">=</span><span class="s">"max_length"</span><span class="p">,</span>
            <span class="n">return_attention_mask</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>  <span class="c1"># Generate the attention mask
</span>            <span class="n">return_tensors</span><span class="o">=</span><span class="s">"pt"</span><span class="p">,</span>  <span class="c1"># ask the function to return PyTorch tensors
</span>        <span class="p">)</span>
        <span class="n">masks</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="s">"attention_mask"</span><span class="p">]</span>
        <span class="n">input_ids</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="s">"input_ids"</span><span class="p">]</span>
        <span class="n">task_embs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="s">"input_ids"</span><span class="p">],</span> <span class="n">tokens</span><span class="p">[</span><span class="s">"attention_mask"</span><span class="p">])[</span>
            <span class="s">"pooler_output"</span>
        <span class="p">].</span><span class="n">detach</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">cfg</span><span class="p">.</span><span class="n">task_embedding_format</span> <span class="o">==</span> <span class="s">"gpt2"</span><span class="p">:</span>
        <span class="n">tz</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="p">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s">"gpt2"</span><span class="p">)</span>
        <span class="n">tz</span><span class="p">.</span><span class="n">pad_token</span> <span class="o">=</span> <span class="n">tz</span><span class="p">.</span><span class="n">eos_token</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="p">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s">"gpt2"</span><span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">tz</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">descriptions</span><span class="p">,</span>  <span class="c1"># the sentence to be encoded
</span>            <span class="n">add_special_tokens</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>  <span class="c1"># Add [CLS] and [SEP]
</span>            <span class="n">max_length</span><span class="o">=</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">max_word_len</span><span class="p">,</span>  <span class="c1"># maximum length of a sentence
</span>            <span class="n">padding</span><span class="o">=</span><span class="s">"max_length"</span><span class="p">,</span>
            <span class="n">return_attention_mask</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>  <span class="c1"># Generate the attention mask
</span>            <span class="n">return_tensors</span><span class="o">=</span><span class="s">"pt"</span><span class="p">,</span>  <span class="c1"># ask the function to return PyTorch tensors
</span>        <span class="p">)</span>
        <span class="n">task_embs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">tokens</span><span class="p">)[</span><span class="s">"last_hidden_state"</span><span class="p">].</span><span class="n">detach</span><span class="p">()[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">cfg</span><span class="p">.</span><span class="n">task_embedding_format</span> <span class="o">==</span> <span class="s">"clip"</span><span class="p">:</span>
        <span class="n">tz</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="p">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s">"openai/clip-vit-base-patch32"</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="p">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s">"openai/clip-vit-base-patch32"</span><span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">tz</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">descriptions</span><span class="p">,</span>  <span class="c1"># the sentence to be encoded
</span>            <span class="n">add_special_tokens</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>  <span class="c1"># Add [CLS] and [SEP]
</span>            <span class="n">max_length</span><span class="o">=</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">max_word_len</span><span class="p">,</span>  <span class="c1"># maximum length of a sentence
</span>            <span class="n">padding</span><span class="o">=</span><span class="s">"max_length"</span><span class="p">,</span>
            <span class="n">return_attention_mask</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>  <span class="c1"># Generate the attention mask
</span>            <span class="n">return_tensors</span><span class="o">=</span><span class="s">"pt"</span><span class="p">,</span>  <span class="c1"># ask the function to return PyTorch tensors
</span>        <span class="p">)</span>
        <span class="n">task_embs</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">get_text_features</span><span class="p">(</span><span class="o">**</span><span class="n">tokens</span><span class="p">).</span><span class="n">detach</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">cfg</span><span class="p">.</span><span class="n">task_embedding_format</span> <span class="o">==</span> <span class="s">"roberta"</span><span class="p">:</span>
        <span class="n">tz</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="p">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s">"roberta-base"</span><span class="p">)</span>
        <span class="n">tz</span><span class="p">.</span><span class="n">pad_token</span> <span class="o">=</span> <span class="n">tz</span><span class="p">.</span><span class="n">eos_token</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="p">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s">"roberta-base"</span><span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">tz</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">descriptions</span><span class="p">,</span>  <span class="c1"># the sentence to be encoded
</span>            <span class="n">add_special_tokens</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>  <span class="c1"># Add [CLS] and [SEP]
</span>            <span class="n">max_length</span><span class="o">=</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">max_word_len</span><span class="p">,</span>  <span class="c1"># maximum length of a sentence
</span>            <span class="n">padding</span><span class="o">=</span><span class="s">"max_length"</span><span class="p">,</span>
            <span class="n">return_attention_mask</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>  <span class="c1"># Generate the attention mask
</span>            <span class="n">return_tensors</span><span class="o">=</span><span class="s">"pt"</span><span class="p">,</span>  <span class="c1"># ask the function to return PyTorch tensors
</span>        <span class="p">)</span>
        <span class="n">task_embs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">tokens</span><span class="p">)[</span><span class="s">"pooler_output"</span><span class="p">].</span><span class="n">detach</span><span class="p">()</span>
    <span class="n">cfg</span><span class="p">.</span><span class="n">policy</span><span class="p">.</span><span class="n">language_encoder</span><span class="p">.</span><span class="n">network_kwargs</span><span class="p">.</span><span class="n">input_size</span> <span class="o">=</span> <span class="n">task_embs</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">task_embs</span>
</code></pre></div></div> <h3 id="5-writing-lifelong-policy"> <a href="#5-writing-lifelong-policy" class="anchor-heading" aria-labelledby="5-writing-lifelong-policy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Writing Lifelong Policy </h3> <p>We use observation head from the codebase only for rgb_modules and language_modules. The example policy implementation shows how a typical lifelong-learning algorithm is trained.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">robomimic.utils.tensor_utils</span> <span class="k">as</span> <span class="n">TensorUtils</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="n">nn</span>

<span class="c1"># AN NOTE: these are relevant parts to import for policies
</span><span class="kn">from</span> <span class="nn">libero.lifelong.models.modules.rgb_modules</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">libero.lifelong.models.modules.language_modules</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">libero.lifelong.models.base_policy</span> <span class="kn">import</span> <span class="n">BasePolicy</span>
<span class="kn">from</span> <span class="nn">libero.lifelong.models.policy_head</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">libero.lifelong.models.modules.transformer_modules</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">ExtraModalityTokens</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">use_joint</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">use_gripper</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">use_ee</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">extra_num_layers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">extra_hidden_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
        <span class="n">extra_embedding_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="s">"""
        This is a class that maps all extra modality inputs into tokens of the same size
        """</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">use_joint</span> <span class="o">=</span> <span class="n">use_joint</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">use_gripper</span> <span class="o">=</span> <span class="n">use_gripper</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">use_ee</span> <span class="o">=</span> <span class="n">use_ee</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">extra_embedding_size</span> <span class="o">=</span> <span class="n">extra_embedding_size</span>

        <span class="n">joint_states_dim</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="n">gripper_states_dim</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">ee_dim</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">num_extra</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">use_joint</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">use_gripper</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">use_ee</span><span class="p">)</span>

        <span class="n">extra_low_level_feature_dim</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">use_joint</span><span class="p">)</span> <span class="o">*</span> <span class="n">joint_states_dim</span>
            <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">use_gripper</span><span class="p">)</span> <span class="o">*</span> <span class="n">gripper_states_dim</span>
            <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">use_ee</span><span class="p">)</span> <span class="o">*</span> <span class="n">ee_dim</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="n">extra_low_level_feature_dim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"[error] no extra information"</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">extra_encoders</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">def</span> <span class="nf">generate_proprio_mlp_fn</span><span class="p">(</span><span class="n">modality_name</span><span class="p">,</span> <span class="n">extra_low_level_feature_dim</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">extra_low_level_feature_dim</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># we indeed have extra information
</span>            <span class="k">if</span> <span class="n">extra_num_layers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">extra_low_level_feature_dim</span><span class="p">,</span> <span class="n">extra_hidden_size</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">extra_num_layers</span><span class="p">):</span>
                    <span class="n">layers</span> <span class="o">+=</span> <span class="p">[</span>
                        <span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">extra_hidden_size</span><span class="p">,</span> <span class="n">extra_hidden_size</span><span class="p">),</span>
                        <span class="n">nn</span><span class="p">.</span><span class="n">ReLU</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="n">layers</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">extra_hidden_size</span><span class="p">,</span> <span class="n">extra_embedding_size</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">extra_low_level_feature_dim</span><span class="p">,</span> <span class="n">extra_embedding_size</span><span class="p">)]</span>

            <span class="bp">self</span><span class="p">.</span><span class="n">proprio_mlp</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">extra_encoders</span><span class="p">[</span><span class="n">modality_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"encoder"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">proprio_mlp</span><span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">proprio_dim</span><span class="p">,</span> <span class="n">use_modality</span><span class="p">,</span> <span class="n">modality_name</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">joint_states_dim</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">use_joint</span><span class="p">,</span> <span class="s">"joint_states"</span><span class="p">),</span>
            <span class="p">(</span><span class="n">gripper_states_dim</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">use_gripper</span><span class="p">,</span> <span class="s">"gripper_states"</span><span class="p">),</span>
            <span class="p">(</span><span class="n">ee_dim</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">use_ee</span><span class="p">,</span> <span class="s">"ee_states"</span><span class="p">),</span>
        <span class="p">]:</span>

            <span class="k">if</span> <span class="n">use_modality</span><span class="p">:</span>
                <span class="n">generate_proprio_mlp_fn</span><span class="p">(</span><span class="n">modality_name</span><span class="p">,</span> <span class="n">proprio_dim</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">encoders</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">ModuleList</span><span class="p">(</span>
            <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s">"encoder"</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">extra_encoders</span><span class="p">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_dict</span><span class="p">):</span>
        <span class="s">"""
        obs_dict: {
            (optional) joint_stats: (B, T, 7),
            (optional) gripper_states: (B, T, 2),
            (optional) ee: (B, T, 3)
        }
        map above to a latent vector of shape (B, T, H)
        """</span>
        <span class="n">tensor_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">use_modality</span><span class="p">,</span> <span class="n">modality_name</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">use_joint</span><span class="p">,</span> <span class="s">"joint_states"</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">use_gripper</span><span class="p">,</span> <span class="s">"gripper_states"</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">use_ee</span><span class="p">,</span> <span class="s">"ee_states"</span><span class="p">),</span>
        <span class="p">]:</span>

            <span class="k">if</span> <span class="n">use_modality</span><span class="p">:</span>
                <span class="n">tensor_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">extra_encoders</span><span class="p">[</span><span class="n">modality_name</span><span class="p">][</span><span class="s">"encoder"</span><span class="p">](</span>
                        <span class="n">obs_dict</span><span class="p">[</span><span class="n">modality_name</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">stack</span><span class="p">(</span><span class="n">tensor_list</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="k">class</span> <span class="nc">MyTransformerPolicy</span><span class="p">(</span><span class="n">BasePolicy</span><span class="p">):</span>
    <span class="s">"""
    Input: (o_{t-H}, ... , o_t)
    Output: a_t or distribution of a_t
    """</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">shape_meta</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">shape_meta</span><span class="p">)</span>
        <span class="n">policy_cfg</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="n">policy</span>

        <span class="c1">### 1. encode image
</span>        <span class="n">embed_size</span> <span class="o">=</span> <span class="n">policy_cfg</span><span class="p">.</span><span class="n">embed_size</span>
        <span class="n">transformer_input_sizes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">image_encoders</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">shape_meta</span><span class="p">[</span><span class="s">"all_shapes"</span><span class="p">].</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s">"rgb"</span> <span class="ow">in</span> <span class="n">name</span> <span class="ow">or</span> <span class="s">"depth"</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="n">policy_cfg</span><span class="p">.</span><span class="n">image_encoder</span><span class="p">.</span><span class="n">network_kwargs</span>
                <span class="n">kwargs</span><span class="p">.</span><span class="n">input_shape</span> <span class="o">=</span> <span class="n">shape_meta</span><span class="p">[</span><span class="s">"all_shapes"</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
                <span class="n">kwargs</span><span class="p">.</span><span class="n">output_size</span> <span class="o">=</span> <span class="n">embed_size</span>
                <span class="n">kwargs</span><span class="p">.</span><span class="n">language_dim</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">policy_cfg</span><span class="p">.</span><span class="n">language_encoder</span><span class="p">.</span><span class="n">network_kwargs</span><span class="p">.</span><span class="n">input_size</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">image_encoders</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">"input_shape"</span><span class="p">:</span> <span class="n">shape_meta</span><span class="p">[</span><span class="s">"all_shapes"</span><span class="p">][</span><span class="n">name</span><span class="p">],</span>
                    <span class="s">"encoder"</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">policy_cfg</span><span class="p">.</span><span class="n">image_encoder</span><span class="p">.</span><span class="n">network</span><span class="p">)(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
                <span class="p">}</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">encoders</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">ModuleList</span><span class="p">(</span>
            <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s">"encoder"</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">image_encoders</span><span class="p">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="p">)</span>

        <span class="c1">### 2. encode language
</span>        <span class="n">policy_cfg</span><span class="p">.</span><span class="n">language_encoder</span><span class="p">.</span><span class="n">network_kwargs</span><span class="p">.</span><span class="n">output_size</span> <span class="o">=</span> <span class="n">embed_size</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">language_encoder</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">policy_cfg</span><span class="p">.</span><span class="n">language_encoder</span><span class="p">.</span><span class="n">network</span><span class="p">)(</span>
            <span class="o">**</span><span class="n">policy_cfg</span><span class="p">.</span><span class="n">language_encoder</span><span class="p">.</span><span class="n">network_kwargs</span>
        <span class="p">)</span>

        <span class="c1">### 3. encode extra information (e.g. gripper, joint_state)
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">extra_encoder</span> <span class="o">=</span> <span class="n">ExtraModalityTokens</span><span class="p">(</span>
            <span class="n">use_joint</span><span class="o">=</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">use_joint</span><span class="p">,</span>
            <span class="n">use_gripper</span><span class="o">=</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">use_gripper</span><span class="p">,</span>
            <span class="n">use_ee</span><span class="o">=</span><span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">use_ee</span><span class="p">,</span>
            <span class="n">extra_num_layers</span><span class="o">=</span><span class="n">policy_cfg</span><span class="p">.</span><span class="n">extra_num_layers</span><span class="p">,</span>
            <span class="n">extra_hidden_size</span><span class="o">=</span><span class="n">policy_cfg</span><span class="p">.</span><span class="n">extra_hidden_size</span><span class="p">,</span>
            <span class="n">extra_embedding_size</span><span class="o">=</span><span class="n">embed_size</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1">### 4. define temporal transformer
</span>        <span class="n">policy_cfg</span><span class="p">.</span><span class="n">temporal_position_encoding</span><span class="p">.</span><span class="n">network_kwargs</span><span class="p">.</span><span class="n">input_size</span> <span class="o">=</span> <span class="n">embed_size</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">temporal_position_encoding_fn</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span>
            <span class="n">policy_cfg</span><span class="p">.</span><span class="n">temporal_position_encoding</span><span class="p">.</span><span class="n">network</span>
        <span class="p">)(</span><span class="o">**</span><span class="n">policy_cfg</span><span class="p">.</span><span class="n">temporal_position_encoding</span><span class="p">.</span><span class="n">network_kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">temporal_transformer</span> <span class="o">=</span> <span class="n">TransformerDecoder</span><span class="p">(</span>
            <span class="n">input_size</span><span class="o">=</span><span class="n">embed_size</span><span class="p">,</span>
            <span class="n">num_layers</span><span class="o">=</span><span class="n">policy_cfg</span><span class="p">.</span><span class="n">transformer_num_layers</span><span class="p">,</span>
            <span class="n">num_heads</span><span class="o">=</span><span class="n">policy_cfg</span><span class="p">.</span><span class="n">transformer_num_heads</span><span class="p">,</span>
            <span class="n">head_output_size</span><span class="o">=</span><span class="n">policy_cfg</span><span class="p">.</span><span class="n">transformer_head_output_size</span><span class="p">,</span>
            <span class="n">mlp_hidden_size</span><span class="o">=</span><span class="n">policy_cfg</span><span class="p">.</span><span class="n">transformer_mlp_hidden_size</span><span class="p">,</span>
            <span class="n">dropout</span><span class="o">=</span><span class="n">policy_cfg</span><span class="p">.</span><span class="n">transformer_dropout</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">policy_head_kwargs</span> <span class="o">=</span> <span class="n">policy_cfg</span><span class="p">.</span><span class="n">policy_head</span><span class="p">.</span><span class="n">network_kwargs</span>
        <span class="n">policy_head_kwargs</span><span class="p">.</span><span class="n">input_size</span> <span class="o">=</span> <span class="n">embed_size</span>
        <span class="n">policy_head_kwargs</span><span class="p">.</span><span class="n">output_size</span> <span class="o">=</span> <span class="n">shape_meta</span><span class="p">[</span><span class="s">"ac_dim"</span><span class="p">]</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">policy_head</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">policy_cfg</span><span class="p">.</span><span class="n">policy_head</span><span class="p">.</span><span class="n">network</span><span class="p">)(</span>
            <span class="o">**</span><span class="n">policy_cfg</span><span class="p">.</span><span class="n">policy_head</span><span class="p">.</span><span class="n">loss_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">policy_cfg</span><span class="p">.</span><span class="n">policy_head</span><span class="p">.</span><span class="n">network_kwargs</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">latent_queue</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">max_seq_len</span> <span class="o">=</span> <span class="n">policy_cfg</span><span class="p">.</span><span class="n">transformer_max_seq_len</span>

    <span class="k">def</span> <span class="nf">temporal_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">pos_emb</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">temporal_position_encoding_fn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">pos_emb</span><span class="p">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (B, T, num_modality, E)
</span>        <span class="n">sh</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">temporal_transformer</span><span class="p">.</span><span class="n">compute_mask</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">TensorUtils</span><span class="p">.</span><span class="n">join_dimensions</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># (B, T*num_modality, E)
</span>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">temporal_transformer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">sh</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># (B, T, E)
</span>
    <span class="k">def</span> <span class="nf">spatial_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># 1. encode extra
</span>        <span class="n">extra</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">extra_encoder</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">"obs"</span><span class="p">])</span>  <span class="c1"># (B, T, num_extra, E)
</span>
        <span class="c1"># 2. encode language, treat it as action token
</span>        <span class="n">B</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">extra</span><span class="p">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">text_encoded</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">language_encoder</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># (B, E)
</span>        <span class="n">text_encoded</span> <span class="o">=</span> <span class="n">text_encoded</span><span class="p">.</span><span class="n">view</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="n">expand</span><span class="p">(</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
        <span class="p">)</span>  <span class="c1"># (B, T, 1, E)
</span>        <span class="n">encoded</span> <span class="o">=</span> <span class="p">[</span><span class="n">text_encoded</span><span class="p">,</span> <span class="n">extra</span><span class="p">]</span>

        <span class="c1"># 3. encode image
</span>        <span class="k">for</span> <span class="n">img_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">image_encoders</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"obs"</span><span class="p">][</span><span class="n">img_name</span><span class="p">]</span>
            <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">shape</span>
            <span class="n">img_encoded</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">image_encoders</span><span class="p">[</span><span class="n">img_name</span><span class="p">][</span><span class="s">"encoder"</span><span class="p">](</span>
                <span class="n">x</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span> <span class="o">*</span> <span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">),</span>
                <span class="n">langs</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">"task_emb"</span><span class="p">]</span>
                <span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="p">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span> <span class="o">*</span> <span class="n">T</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">).</span><span class="n">view</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">encoded</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">img_encoded</span><span class="p">)</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cat</span><span class="p">(</span><span class="n">encoded</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># (B, T, num_modalities, E)
</span>        <span class="k">return</span> <span class="n">encoded</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">spatial_encode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">temporal_encode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">policy_head</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dist</span>

    <span class="k">def</span> <span class="nf">get_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">eval</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">preprocess_input</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">train_mode</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">spatial_encode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">latent_queue</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">latent_queue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">.</span><span class="n">max_seq_len</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">latent_queue</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cat</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">latent_queue</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (B, T, H_all)
</span>            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">temporal_encode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">policy_head</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">dist</span><span class="p">.</span><span class="n">sample</span><span class="p">().</span><span class="n">detach</span><span class="p">().</span><span class="n">cpu</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">action</span><span class="p">.</span><span class="n">view</span><span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="n">numpy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">latent_queue</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></div> <h3 id="6-lifelong-data-structure"> <a href="#6-lifelong-data-structure" class="anchor-heading" aria-labelledby="6-lifelong-data-structure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6. Lifelong Data Structure </h3> <p>We need to wrap our code around a data structure that uses proper training BC handling such as experience replay. I forgot this existed, so I will write a page on this later as this may have been the source of my troubles.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">libero.lifelong.algos.base</span> <span class="kn">import</span> <span class="n">Sequential</span>

<span class="c1">### All lifelong learning algorithm should inherit the Sequential algorithm super class
</span>
<span class="k">class</span> <span class="nc">MyLifelongAlgo</span><span class="p">(</span><span class="n">Sequential</span><span class="p">):</span>
    <span class="s">"""
    The experience replay policy.
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">n_tasks</span><span class="p">,</span>
                 <span class="n">cfg</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">policy_kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">n_tasks</span><span class="o">=</span><span class="n">n_tasks</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span> <span class="o">**</span><span class="n">policy_kwargs</span><span class="p">)</span>
        <span class="c1"># define the learning policy
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">policy</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="n">policy</span><span class="p">.</span><span class="n">policy_type</span><span class="p">)(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">cfg</span><span class="p">.</span><span class="n">shape_meta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="c1"># what to do at the beginning of a new task
</span>        <span class="nb">super</span><span class="p">().</span><span class="n">start_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">end_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">):</span>
        <span class="c1"># what to do when finish learning a new task
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">datasets</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># how the algorithm observes a data and returns a loss to be optimized
</span>        <span class="n">loss</span> <span class="o">=</span> <span class="nb">super</span><span class="p">().</span><span class="n">observe</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loss</span>
</code></pre></div></div> <h3 id="7-training-loop"> <a href="#7-training-loop" class="anchor-heading" aria-labelledby="7-training-loop"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7. Training Loop </h3> <p>We can finally write our training loop which isn’t so complicated. For my purpose, I wil just keep <code class="language-plaintext highlighter-rouge">i = idx</code> and train the agent on one task.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">trange</span>
<span class="kn">from</span> <span class="nn">libero.lifelong.metric</span> <span class="kn">import</span> <span class="n">evaluate_loss</span><span class="p">,</span> <span class="n">evaluate_success</span>
<span class="kn">from</span> <span class="nn">libero.lifelong.utils</span> <span class="kn">import</span> <span class="n">safe_device</span><span class="p">,</span> <span class="n">create_experiment_dir</span>

<span class="n">algo</span> <span class="o">=</span> <span class="n">safe_device</span><span class="p">(</span><span class="n">MyLifelongAlgo</span><span class="p">(</span><span class="n">n_tasks</span><span class="p">,</span> <span class="n">cfg</span><span class="p">),</span> <span class="n">cfg</span><span class="p">.</span><span class="n">device</span><span class="p">)</span>

<span class="n">result_summary</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'L_conf_mat'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_tasks</span><span class="p">,</span> <span class="n">n_tasks</span><span class="p">)),</span>   <span class="c1"># loss confusion matrix
</span>    <span class="s">'S_conf_mat'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_tasks</span><span class="p">,</span> <span class="n">n_tasks</span><span class="p">)),</span>   <span class="c1"># success confusion matrix
</span>    <span class="s">'L_fwd'</span>     <span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_tasks</span><span class="p">,)),</span>           <span class="c1"># loss AUC, how fast the agent learns
</span>    <span class="s">'S_fwd'</span>     <span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_tasks</span><span class="p">,)),</span>           <span class="c1"># success AUC, how fast the agent succeeds
</span><span class="p">}</span>
<span class="n">gsz</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">task_group_size</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="n">n_tasks</span><span class="p">):</span>
    <span class="n">algo</span><span class="p">.</span><span class="n">train</span><span class="p">()</span>
    <span class="n">s_fwd</span><span class="p">,</span> <span class="n">l_fwd</span> <span class="o">=</span> <span class="n">algo</span><span class="p">.</span><span class="n">learn_one_task</span><span class="p">(</span><span class="n">datasets</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">,</span> <span class="n">result_summary</span><span class="p">)</span>
    <span class="c1"># s_fwd is success rate AUC, when the agent learns the {0, e, 2e, ...} epochs
</span>    <span class="c1"># l_fwd is BC loss AUC, similar to s_fwd
</span>    <span class="n">result_summary</span><span class="p">[</span><span class="s">"S_fwd"</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_fwd</span>
    <span class="n">result_summary</span><span class="p">[</span><span class="s">"L_fwd"</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l_fwd</span>

    <span class="k">if</span> <span class="n">cfg</span><span class="p">.</span><span class="nb">eval</span><span class="p">.</span><span class="nb">eval</span><span class="p">:</span>
        <span class="n">algo</span><span class="p">.</span><span class="nb">eval</span><span class="p">()</span>
        <span class="c1"># we only evaluate on the past tasks: 0 .. i
</span>        <span class="n">L</span> <span class="o">=</span> <span class="n">evaluate_loss</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">algo</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">,</span> <span class="n">datasets</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># (i+1,)
</span>        <span class="n">S</span> <span class="o">=</span> <span class="n">evaluate_success</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">algo</span><span class="p">,</span> <span class="n">benchmark</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">gsz</span><span class="p">)))</span> <span class="c1"># (i+1,)
</span>        <span class="n">result_summary</span><span class="p">[</span><span class="s">"L_conf_mat"</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>
        <span class="n">result_summary</span><span class="p">[</span><span class="s">"S_conf_mat"</span><span class="p">][</span><span class="n">i</span><span class="p">][:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span>

        <span class="n">torch</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">result_summary</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s">'result.pt'</span><span class="p">))</span>
</code></pre></div></div> <h3 id="8-visualize-resultss"> <a href="#8-visualize-resultss" class="anchor-heading" aria-labelledby="8-visualize-resultss"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8. Visualize resultss </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result_summary</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s">'result.pt'</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s">"S_conf_mat"</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">result_summary</span><span class="p">[</span><span class="s">"S_fwd"</span><span class="p">])</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">benchmark_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"libero_10"</span>     <span class="p">:</span> <span class="s">"LIBERO_10"</span><span class="p">,</span>
    <span class="s">"libero_90"</span>     <span class="p">:</span> <span class="s">"LIBERO_90"</span><span class="p">,</span>
    <span class="s">"libero_spatial"</span><span class="p">:</span> <span class="s">"LIBERO_SPATIAL"</span><span class="p">,</span>
    <span class="s">"libero_object"</span> <span class="p">:</span> <span class="s">"LIBERO_OBJECT"</span><span class="p">,</span>
    <span class="s">"libero_goal"</span>   <span class="p">:</span> <span class="s">"LIBERO_GOAL"</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">algo_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"base"</span>     <span class="p">:</span> <span class="s">"Sequential"</span><span class="p">,</span>
    <span class="s">"er"</span>       <span class="p">:</span> <span class="s">"ER"</span><span class="p">,</span>
    <span class="s">"ewc"</span>      <span class="p">:</span> <span class="s">"EWC"</span><span class="p">,</span>
    <span class="s">"packnet"</span>  <span class="p">:</span> <span class="s">"PackNet"</span><span class="p">,</span>
    <span class="s">"multitask"</span><span class="p">:</span> <span class="s">"Multitask"</span><span class="p">,</span>
    <span class="s">"custom_algo"</span>   <span class="p">:</span> <span class="s">"MyLifelongAlgo"</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">policy_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"bc_rnn_policy"</span>        <span class="p">:</span> <span class="s">"BCRNNPolicy"</span><span class="p">,</span>
    <span class="s">"bc_transformer_policy"</span><span class="p">:</span> <span class="s">"BCTransformerPolicy"</span><span class="p">,</span>
    <span class="s">"bc_vilt_policy"</span>       <span class="p">:</span> <span class="s">"BCViLTPolicy"</span><span class="p">,</span>
    <span class="s">"custom_policy"</span>        <span class="p">:</span> <span class="s">"MyTransformerPolicy"</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">seeds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10000</span><span class="p">]</span>
<span class="n">N_SEEDS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seeds</span><span class="p">)</span>
<span class="n">N_TASKS</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">def</span> <span class="nf">get_auc</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="n">bench</span><span class="p">,</span> <span class="n">algo</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span>
    <span class="n">N_EP</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">n_epochs</span> <span class="o">//</span> <span class="n">cfg</span><span class="p">.</span><span class="nb">eval</span><span class="p">.</span><span class="n">eval_every</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">fwds</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N_TASKS</span><span class="p">,</span> <span class="n">N_EP</span><span class="p">,</span> <span class="n">N_SEEDS</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_TASKS</span><span class="p">):</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seeds</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">experiment_dir</span><span class="si">}</span><span class="s">/task</span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s">_auc.log"</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">succ</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="s">"success"</span><span class="p">]</span> <span class="c1"># (n_epochs)
</span>                <span class="n">idx</span> <span class="o">=</span> <span class="n">succ</span><span class="p">.</span><span class="n">argmax</span><span class="p">()</span>
                <span class="n">succ</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span> <span class="o">=</span> <span class="n">succ</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">fwds</span><span class="p">[</span><span class="n">task</span><span class="p">,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">succ</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Some errors when loading results"</span><span class="p">)</span>
                <span class="k">continue</span>
    <span class="k">return</span> <span class="n">fwds</span>

<span class="k">def</span> <span class="nf">compute_metric</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
    <span class="n">mat</span><span class="p">,</span> <span class="n">fwts</span>  <span class="o">=</span> <span class="n">res</span> <span class="c1"># fwds: (num_tasks, num_save_intervals, num_seeds)
</span>    <span class="n">num_tasks</span><span class="p">,</span> <span class="n">num_seeds</span> <span class="o">=</span> <span class="n">mat</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># compute fwt
</span>    <span class="n">fwt</span> <span class="o">=</span> <span class="n">fwts</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ret</span><span class="p">[</span><span class="s">"fwt"</span><span class="p">]</span> <span class="o">=</span> <span class="n">fwt</span>
    <span class="c1"># compute bwt
</span>    <span class="n">bwts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">aucs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_seeds</span><span class="p">):</span>
        <span class="n">bwt</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">auc</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_tasks</span><span class="p">):</span>
            <span class="n">bwt_k</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">auc_k</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_tasks</span><span class="p">):</span>
                <span class="n">bwt_k</span> <span class="o">+=</span> <span class="n">mat</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">seed</span><span class="p">]</span> <span class="o">-</span> <span class="n">mat</span><span class="p">[</span><span class="n">tau</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">seed</span><span class="p">]</span>
                <span class="n">auc_k</span> <span class="o">+=</span> <span class="n">mat</span><span class="p">[</span><span class="n">tau</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">seed</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">num_tasks</span><span class="p">:</span>
                <span class="n">bwt_k</span> <span class="o">/=</span> <span class="p">(</span><span class="n">num_tasks</span> <span class="o">-</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">auc_k</span> <span class="o">=</span> <span class="p">(</span><span class="n">auc_k</span> <span class="o">+</span> <span class="n">fwts</span><span class="p">[</span><span class="n">k</span><span class="p">,:,</span><span class="n">seed</span><span class="p">].</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">num_tasks</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span>

            <span class="n">bwt</span> <span class="o">+=</span> <span class="n">bwt_k</span>
            <span class="n">auc</span> <span class="o">+=</span> <span class="n">auc_k</span>
        <span class="n">bwts</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">bwt</span> <span class="o">/</span> <span class="n">num_tasks</span><span class="p">)</span>
        <span class="n">aucs</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">auc</span> <span class="o">/</span> <span class="n">num_tasks</span><span class="p">)</span>
    <span class="n">bwts</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">bwts</span><span class="p">)</span>
    <span class="n">aucs</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">aucs</span><span class="p">)</span>
    <span class="n">ret</span><span class="p">[</span><span class="s">"bwt"</span><span class="p">]</span> <span class="o">=</span> <span class="n">bwts</span>
    <span class="n">ret</span><span class="p">[</span><span class="s">"auc"</span><span class="p">]</span> <span class="o">=</span> <span class="n">aucs</span>
    <span class="k">return</span> <span class="n">ret</span>


<span class="n">experiment_dir</span> <span class="o">=</span> <span class="s">"experiments"</span>
<span class="n">benchmark_name</span> <span class="o">=</span> <span class="s">"libero_object"</span>
<span class="n">algo_name</span> <span class="o">=</span> <span class="s">"custom_algo"</span>
<span class="n">policy_name</span> <span class="o">=</span> <span class="s">"custom_policy"</span>

<span class="n">fwds</span> <span class="o">=</span> <span class="n">get_auc</span><span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="n">benchmark_name</span><span class="p">,</span> <span class="n">algo_name</span><span class="p">,</span> <span class="n">policy_name</span><span class="p">)</span>

<span class="n">conf_mat</span> <span class="o">=</span> <span class="n">result_summary</span><span class="p">[</span><span class="s">"S_conf_mat"</span><span class="p">][...,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">metric</span> <span class="o">=</span> <span class="n">compute_metric</span><span class="p">((</span><span class="n">conf_mat</span><span class="p">,</span> <span class="n">fwds</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
</code></pre></div></div> <h3 id="9-visualize-rollouts"> <a href="#9-visualize-rollouts" class="anchor-heading" aria-labelledby="9-visualize-rollouts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 9. Visualize rollouts </h3> <p>This is the kind of stuff we want. Once we train a model, we can visualize the rollouts and see how well it performs.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64encode</span>
<span class="kn">import</span> <span class="nn">imageio</span>

<span class="kn">from</span> <span class="nn">libero.libero.envs</span> <span class="kn">import</span> <span class="n">OffScreenRenderEnv</span><span class="p">,</span> <span class="n">DummyVectorEnv</span>
<span class="kn">from</span> <span class="nn">libero.lifelong.metric</span> <span class="kn">import</span> <span class="n">raw_obs_to_tensor_obs</span>

<span class="c1"># You can turn on subprocess
</span><span class="n">env_num</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">action_dim</span> <span class="o">=</span> <span class="mi">7</span>


<span class="c1"># If it's packnet, the weights need to be processed first
</span><span class="n">task_id</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">.</span><span class="n">get_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
<span class="n">task_emb</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">.</span><span class="n">get_task_emb</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>

<span class="k">if</span> <span class="n">cfg</span><span class="p">.</span><span class="n">lifelong</span><span class="p">.</span><span class="n">algo</span> <span class="o">==</span> <span class="s">"PackNet"</span><span class="p">:</span>
    <span class="n">algo</span> <span class="o">=</span> <span class="n">algo</span><span class="p">.</span><span class="n">get_eval_algo</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>

<span class="n">algo</span><span class="p">.</span><span class="nb">eval</span><span class="p">()</span>
<span class="n">env_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"bddl_file_name"</span><span class="p">:</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">cfg</span><span class="p">.</span><span class="n">bddl_folder</span><span class="p">,</span> <span class="n">task</span><span class="p">.</span><span class="n">problem_folder</span><span class="p">,</span> <span class="n">task</span><span class="p">.</span><span class="n">bddl_file</span>
    <span class="p">),</span>
    <span class="s">"camera_heights"</span><span class="p">:</span> <span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">img_h</span><span class="p">,</span>
    <span class="s">"camera_widths"</span><span class="p">:</span> <span class="n">cfg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">img_w</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">DummyVectorEnv</span><span class="p">(</span>
            <span class="p">[</span><span class="k">lambda</span><span class="p">:</span> <span class="n">OffScreenRenderEnv</span><span class="p">(</span><span class="o">**</span><span class="n">env_args</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">env_num</span><span class="p">)]</span>
<span class="p">)</span>

<span class="n">init_states_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">cfg</span><span class="p">.</span><span class="n">init_states_folder</span><span class="p">,</span> <span class="n">task</span><span class="p">.</span><span class="n">problem_folder</span><span class="p">,</span> <span class="n">task</span><span class="p">.</span><span class="n">init_states_file</span>
<span class="p">)</span>
<span class="n">init_states</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">init_states_path</span><span class="p">)</span>

<span class="n">env</span><span class="p">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">init_state</span> <span class="o">=</span> <span class="n">init_states</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="n">dones</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">]</span>

<span class="n">algo</span><span class="p">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="p">.</span><span class="n">set_init_state</span><span class="p">(</span><span class="n">init_state</span><span class="p">)</span>


<span class="c1"># Make sure the gripepr is open to make it consistent with the provided demos.
</span><span class="n">dummy_actions</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">env_num</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">))</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">obs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="n">dummy_actions</span><span class="p">)</span>

<span class="n">steps</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">obs_tensors</span> <span class="o">=</span> <span class="p">[[]]</span> <span class="o">*</span> <span class="n">env_num</span>
<span class="k">while</span> <span class="n">steps</span> <span class="o">&lt;</span> <span class="n">cfg</span><span class="p">.</span><span class="nb">eval</span><span class="p">.</span><span class="n">max_steps</span><span class="p">:</span>
    <span class="n">steps</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">raw_obs_to_tensor_obs</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">task_emb</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">algo</span><span class="p">.</span><span class="n">policy</span><span class="p">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">env_num</span><span class="p">):</span>
        <span class="n">dones</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">dones</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">or</span> <span class="n">done</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">obs_tensors</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">"agentview_image"</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">dones</span><span class="p">):</span>
        <span class="k">break</span>

<span class="c1"># visualize video
# obs_tensor: (env_num, T, H, W, C)
</span>
<span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">img</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">obs_tensors</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">fps</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">writer</span>  <span class="o">=</span> <span class="n">imageio</span><span class="p">.</span><span class="n">get_writer</span><span class="p">(</span><span class="s">'tmp_video.mp4'</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">)</span>
<span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">append_data</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">writer</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">video_data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"tmp_video.mp4"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
<span class="n">video_tag</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'&lt;video controls alt="test" src="data:video/mp4;base64,</span><span class="si">{</span><span class="n">b64encode</span><span class="p">(</span><span class="n">video_data</span><span class="p">).</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s">"&gt;'</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">video_tag</span><span class="p">)</span>
</code></pre></div></div> </main> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">By An Dang.</p> <div class="d-flex mt-2"> <p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/dangthanhan507/dangthanhan507.github.io/blob/master/code-notes/benchmark-notes/libero/code.md" id="edit-this-page">Edit this page on GitHub.</a> </p> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> <script type="module"> import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.esm.min.mjs'; var config = {} ; mermaid.initialize(config); mermaid.run({ querySelector: '.language-mermaid', }); </script> </body> </html>
