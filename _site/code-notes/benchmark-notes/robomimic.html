<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/blog/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/blog/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li:not(:nth-child(3)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(5) > ul > li:nth-child(3) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(1) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(5) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(1) > ul > li:nth-child(5) > ul > li:nth-child(3) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(5) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(1) > ul.nav-list > li.nav-list-item:nth-child(5) > ul.nav-list > li.nav-list-item:nth-child(3) > ul.nav-list { display: block; } </style> <script src="/blog/assets/js/vendor/lunr.min.js"></script> <script src="/blog/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Robomimic | Notes</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="Robomimic" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Just messing around right now" /> <meta property="og:description" content="Just messing around right now" /> <link rel="canonical" href="http://localhost:4000/blog/code-notes/benchmark-notes/robomimic.html" /> <meta property="og:url" content="http://localhost:4000/blog/code-notes/benchmark-notes/robomimic.html" /> <meta property="og:site_name" content="Notes" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Robomimic" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Just messing around right now","headline":"Robomimic","url":"http://localhost:4000/blog/code-notes/benchmark-notes/robomimic.html"}</script> <!-- End Jekyll SEO tag --> <link rel="icon" href="data:,"> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_CHTML"> </script> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/blog/" class="site-title lh-tight"> Notes </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Code Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/" class="nav-list-link">Code Notes</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/code-notes/how-to-pdb.html" class="nav-list-link">How-to PDB</a></li><li class="nav-list-item"><a href="/blog/code-notes/how-to-tmux.html" class="nav-list-link">How-to Tmux</a></li><li class="nav-list-item"><a href="/blog/code-notes/distributed-dl.html" class="nav-list-link">Distributed Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/image-augmentation.html" class="nav-list-link">Image Augmentation (Torchvision)</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Benchmarks category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/benchmark-notes/" class="nav-list-link">Benchmarks</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Robocasa category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/benchmark-notes/robocasa/" class="nav-list-link">Robocasa</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/code-notes/benchmark-notes/robocasa/paper.html" class="nav-list-link">Paper</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Libero category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/benchmark-notes/libero/" class="nav-list-link">Libero</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/code-notes/benchmark-notes/libero/paper.html" class="nav-list-link">Paper</a></li><li class="nav-list-item"><a href="/blog/code-notes/benchmark-notes/libero/code.html" class="nav-list-link">Code</a></li></ul></li><li class="nav-list-item"><a href="/blog/code-notes/benchmark-notes/robomimic.html" class="nav-list-link">Robomimic</a></li></ul></li><li class="nav-list-item"><a href="/blog/code-notes/python-env.html" class="nav-list-link">Python Environments</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in GROOT category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/groot/" class="nav-list-link">GROOT</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/code-notes/groot/code.html" class="nav-list-link">Code</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Isaac category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/isaac/" class="nav-list-link">Isaac</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/code-notes/isaac/setup.html" class="nav-list-link">Isaac Setup</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/doc_notes.html" class="nav-list-link">Isaac Gym Doc Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/gymenv-obs.html" class="nav-list-link">IsaacGymEnv Obs Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/gymenv-cam.html" class="nav-list-link">IsaacGymEnv Camera Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/gymenv-network.html" class="nav-list-link">IsaacGymEnv Network Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/gymenv-tacsl.html" class="nav-list-link">IsaacGymEnv Tacsl Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/gymenv-assets.html" class="nav-list-link">IsaacGymEnv Assets Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/gymenv-env.html" class="nav-list-link">IsaacGymEnv Env Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/gymenv-task.html" class="nav-list-link">IsaacGymEnv Task Notes</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/rl_games_integration.html" class="nav-list-link">RL Games Coupling</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaac/setup_isaacgymenvs.html" class="nav-list-link">IsaacGymEnvs Setup</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Cluster Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/cluster-notes/" class="nav-list-link">Cluster Notes</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/code-notes/cluster-notes/great-lakes.html" class="nav-list-link">Great Lakes Cluster</a></li><li class="nav-list-item"><a href="/blog/code-notes/cluster-notes/slurm-interactive.html" class="nav-list-link">SLURM Interactive</a></li><li class="nav-list-item"><a href="/blog/code-notes/cluster-notes/slurm.html" class="nav-list-link">SLURM</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Isaac Lab category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/code-notes/isaaclab/" class="nav-list-link">Isaac Lab</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/code-notes/isaaclab/setup.html" class="nav-list-link">Isaac Lab Setup</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaaclab/isaacsim-start.html" class="nav-list-link">Isaac Sim Python Start</a></li><li class="nav-list-item"><a href="/blog/code-notes/isaaclab/isaacsim-hello-world.html" class="nav-list-link">IsaacSim Core (Hello World)</a></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Conference Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/conference-notes/" class="nav-list-link">Conference Notes</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in ICRA 2025 category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/conference-notes/icra-2025/" class="nav-list-link">ICRA 2025</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/workshop/beyond-pick-place.html" class="nav-list-link">Beyond Pick and Place Workshop</a></li><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/workshop/contact-rich.html" class="nav-list-link">Contact Rich Workshop</a></li><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/workshop/handy.html" class="nav-list-link">Handy Workshop</a></li><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/homework.html" class="nav-list-link">Homework</a></li><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/keynote-manipulation.html" class="nav-list-link">Manipulation Keynote</a></li><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/keynote-opt.html" class="nav-list-link">Optimization Control Keynote</a></li><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/workshop/neuro-symbolic.html" class="nav-list-link">Neuro-Symbolic Workshop</a></li><li class="nav-list-item"><a href="/blog/conference-notes/icra-2025/workshop/space.html" class="nav-list-link">Space Workshop</a></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Class Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/class-notes/" class="nav-list-link">Class Notes</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in MATH 658: Geometric Mechanics category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/class-notes/00-Geometric-Mechanics/" class="nav-list-link">MATH 658: Geometric Mechanics</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in 658-Lectures category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/class-notes/00-Geometric-Mechanics/Lectures/" class="nav-list-link">658-Lectures</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/class-notes/00-Geometric-Mechanics/Lectures/08-27.html" class="nav-list-link">August 27</a></li><li class="nav-list-item"><a href="/blog/class-notes/00-Geometric-Mechanics/Lectures/09-03.html" class="nav-list-link">September 3</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Textbook category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/class-notes/00-Geometric-Mechanics/Textbook/" class="nav-list-link">Textbook</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/class-notes/00-Geometric-Mechanics/Textbook/diff-manifold.html" class="nav-list-link">Differentiable Manifold (2.2)</a></li><li class="nav-list-item"><a href="/blog/class-notes/00-Geometric-Mechanics/Textbook/variational-mech.html" class="nav-list-link">Variational Mechanics (1.2 - 1.3)</a></li><li class="nav-list-item"><a href="/blog/class-notes/00-Geometric-Mechanics/Textbook/vector-fields.html" class="nav-list-link">Vector Fields (2.1)</a></li></ul></li></ul></li><li class="nav-list-item"><a href="/blog/class-notes/01-Math-of-Bio-Networks/" class="nav-list-link">MATH 540: Mathematics for Biological Networks</a></li><li class="nav-list-item"><a href="/blog/class-notes/02-Online-Learning-Control/" class="nav-list-link">AEROSP 740: Online Learning for Control</a></li><li class="nav-list-item"><a href="/blog/class-notes/03-CVOPT-Control/" class="nav-list-link">ECE 598: Convex Optimization Methods in Control</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Sensorimotor Learning category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/class-notes/04-Computational-Sensorimotor-Learning/" class="nav-list-link">Sensorimotor Learning</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/class-notes/04-Computational-Sensorimotor-Learning/simple-decision.html" class="nav-list-link">1. Simple Decisions</a></li><li class="nav-list-item"><a href="/blog/class-notes/04-Computational-Sensorimotor-Learning/sequential-decision.html" class="nav-list-link">2. Sequential Decisions</a></li><li class="nav-list-item"><a href="/blog/class-notes/04-Computational-Sensorimotor-Learning/policy-grad.html" class="nav-list-link">3. Policy Gradients</a></li><li class="nav-list-item"><a href="/blog/class-notes/04-Computational-Sensorimotor-Learning/reward-function.html" class="nav-list-link">4. Reward Function</a></li><li class="nav-list-item"><a href="/blog/class-notes/04-Computational-Sensorimotor-Learning/learning-from-demo.html" class="nav-list-link">5. Learning Demos</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Unsupervised Learning category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/class-notes/05-Unsupervised-Learning/" class="nav-list-link">Unsupervised Learning</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/1_autoregressive.html" class="nav-list-link">1. Autoregressive</a></li><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/2_flow.html" class="nav-list-link">2. Flow</a></li><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/3_lvm.html" class="nav-list-link">3. Latent Variable Models</a></li><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/3a_lvm.html" class="nav-list-link">3a. LVM Papers</a></li><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/4_implicit_sample.html" class="nav-list-link">4. Implicit Models</a></li><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/5_diffusion.html" class="nav-list-link">5. Diffusion</a></li><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/5a_diffusion.html" class="nav-list-link">5a. Diffusion Papers</a></li><li class="nav-list-item"><a href="/blog/class-notes/05-Unsupervised-Learning/6_self_supervised.html" class="nav-list-link">6. Self-Supervised Learning</a></li></ul></li><li class="nav-list-item"><a href="/blog/class-notes/06-Flow-Matching/" class="nav-list-link">Flow Matching and Diffusion</a></li><li class="nav-list-item"><a href="/blog/class-notes/07-Deep-RL/" class="nav-list-link">Deep Reinforcement Learning</a></li><li class="nav-list-item"><a href="/blog/class-notes/08-Deep-Multitask-Learning/" class="nav-list-link">Deep Multi-Task and Meta Learning</a></li><li class="nav-list-item"><a href="/blog/class-notes/09-Algebraic-Techniques-Optimization/" class="nav-list-link">Algebraic Techniques for Optimization</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Deep Dive Ideas category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/deep-dive-notes/" class="nav-list-link">Deep Dive Ideas</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Debug Point ML category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/deep-dive-notes/debug-point-ml/" class="nav-list-link">Debug Point ML</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/deep-dive-notes/debug-point-ml/pointnet.html" class="nav-list-link">PointNet</a></li><li class="nav-list-item"><a href="/blog/deep-dive-notes/debug-point-ml/spatial-transformer.html" class="nav-list-link">Spatial Transformer Networks</a></li></ul></li><li class="nav-list-item"><a href="/blog/deep-dive-notes/limit-surface/" class="nav-list-link">Limit Surface Planner</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Tactile RL Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/deep-dive-notes/tactile-rl-notes/" class="nav-list-link">Tactile RL Notes</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/deep-dive-notes/tactile-rl-notes/fots.html" class="nav-list-link">FOTS</a></li><li class="nav-list-item"><a href="/blog/deep-dive-notes/tactile-rl-notes/roadmap-rl.html" class="nav-list-link">Roadmap to RL</a></li><li class="nav-list-item"><a href="/blog/deep-dive-notes/tactile-rl-notes/roadmap-tactile-rl.html" class="nav-list-link">Roadmap to Tactile RL</a></li><li class="nav-list-item"><a href="/blog/deep-dive-notes/tactile-rl-notes/sim2real-tactile-rl.html" class="nav-list-link">Sim2real Tactile RL</a></li><li class="nav-list-item"><a href="/blog/deep-dive-notes/tactile-rl-notes/tacsl.html" class="nav-list-link">TacSL</a></li><li class="nav-list-item"><a href="/blog/deep-dive-notes/tactile-rl-notes/taxim.html" class="nav-list-link">Taxim</a></li></ul></li></ul></li><li class="nav-list-item"><a href="/blog/paper-notes/" class="nav-list-link">Deep Dive Papers</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Judo Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/judo-notes/" class="nav-list-link">Judo Notes</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/judo-notes/taught.html" class="nav-list-link">Taught Moves</a></li><li class="nav-list-item"><a href="/blog/judo-notes/tolearn.html" class="nav-list-link">To Learn</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Kuka FRI Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/kuka-notes/" class="nav-list-link">Kuka FRI Notes</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/kuka-notes/code.html" class="nav-list-link">Code</a></li><li class="nav-list-item"><a href="/blog/kuka-notes/setup.html" class="nav-list-link">Setup FRI</a></li></ul></li><li class="nav-list-item"><a href="/blog/ml-git-gud-notes/" class="nav-list-link">ML (Git Gud) Resources</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in PhD Project Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/project-notes/" class="nav-list-link">PhD Project Notes</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/project-notes/hand-notes.html" class="nav-list-link">Hand Notes</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Graph Insertion category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/project-notes/project1/" class="nav-list-link">Graph Insertion</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Lit Review (Graph Insertion) category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/project-notes/project1/lit_review/" class="nav-list-link">Lit Review (Graph Insertion)</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/project-notes/project1/lit_review/robopack.html" class="nav-list-link">Robopack</a></li><li class="nav-list-item"><a href="/blog/project-notes/project1/lit_review/tactile-control-extrinsic.html" class="nav-list-link">Extrinsic Contact Control</a></li></ul></li><li class="nav-list-item"><a href="/blog/project-notes/project1/math.html" class="nav-list-link">Math Notes</a></li><li class="nav-list-item"><a href="/blog/project-notes/project1/project.html" class="nav-list-link">Point RL</a></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Prerequisites category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/prereq-notes/" class="nav-list-link">Prerequisites</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/prereq-notes/calc-variation.html" class="nav-list-link">Calculus of Variations - Chill</a></li><li class="nav-list-item"><a href="/blog/prereq-notes/calc-variation2.html" class="nav-list-link">Calculus of Variations - Serious</a></li><li class="nav-list-item"><a href="/blog/prereq-notes/groups.html" class="nav-list-link">GDL 1: Groups</a></li><li class="nav-list-item"><a href="/blog/prereq-notes/topology.html" class="nav-list-link">GDL 2: Topology</a></li><li class="nav-list-item"><a href="/blog/prereq-notes/manifolds.html" class="nav-list-link">GDL 3: Manifolds</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Quick Notes on Graphs category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/blog/graph-notes/" class="nav-list-link">Quick Notes on Graphs</a><ul class="nav-list"><li class="nav-list-item"><a href="/blog/graph-notes/advective-diff.html" class="nav-list-link">Advective Diffusion</a></li><li class="nav-list-item"><a href="/blog/graph-notes/beyond-wl.html" class="nav-list-link">Beyond WL-test</a></li><li class="nav-list-item"><a href="/blog/graph-notes/wl-test-gnn.html" class="nav-list-link">GNN WL-test</a></li><li class="nav-list-item"><a href="/blog/graph-notes/gnn-grad-flow.html" class="nav-list-link">GNN as Gradient Flow</a></li><li class="nav-list-item"><a href="/blog/graph-notes/gnn-pde.html" class="nav-list-link">GNNs as PDEs</a></li><li class="nav-list-item"><a href="/blog/graph-notes/graph-rewiring.html" class="nav-list-link">Graph Rewiring</a></li><li class="nav-list-item"><a href="/blog/graph-notes/latent-gnn.html" class="nav-list-link">Latent GNNs</a></li><li class="nav-list-item"><a href="/blog/graph-notes/neural-sheaf-diffusion.html" class="nav-list-link">Neural Sheaf Diffusion</a></li><li class="nav-list-item"><a href="/blog/graph-notes/deep-gnn.html" class="nav-list-link">Scaling GNNs</a></li><li class="nav-list-item"><a href="/blog/graph-notes/temporal-gnn.html" class="nav-list-link">Temporal GNNs</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Notes" aria-label="Search Notes" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/blog/code-notes/">Code Notes</a></li> <li class="breadcrumb-nav-list-item"><a href="/blog/code-notes/benchmark-notes/">Benchmarks</a></li> <li class="breadcrumb-nav-list-item"><span>Robomimic</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="diffusion-policy-lift-task"> <a href="#diffusion-policy-lift-task" class="anchor-heading" aria-labelledby="diffusion-policy-lift-task"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Diffusion Policy Lift Task </h1> <p><a href="https://github.com/real-stanford/diffusion_policy/tree/main/diffusion_policy">Diffusion Policy Codebase</a></p> <p>Based on <i> lift_image.yaml </i> and it states that dataset comes from the robomimic dataset</p><hr /> <h1 id="robomimic"> <a href="#robomimic" class="anchor-heading" aria-labelledby="robomimic"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Robomimic </h1> <p><a href="https://github.com/ARISE-Initiative/robomimic">Robomimic Codebase</a></p> <p>After taking a look at RoboMimic, it seems that understanding this paper is essential for understanding how to do BC on a robot. I would recommend anyone getting into BC to read this paper deeply.</p> <h3 id="pre-code-dive"> <a href="#pre-code-dive" class="anchor-heading" aria-labelledby="pre-code-dive"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pre-Code Dive </h3> <p><a href="https://arxiv.org/pdf/2108.03298">Paper link</a></p> <p>Based on <i> README.md </i> 3/11/2025 robomimic datasets move to HuggingFace.</p> <p><b> IMPORTANT </b> from Robomimic, we see that randomizing object in ADDITION to randomizing robot state (by a little) matters in getting robust performance.</p> <p><b> IMPORTANT </b> from Robomimic, we see that BC-RNN performs better by a large margin against just BC (concatenate horizon of observations as features).</p> <p><img src="../../assets/images/code/lift/robomimic_lowdim_obs_table.png" alt="" /></p> <p><i> <b>Figure 1:</b> (MG) is machine generated. (PH) is proficient human. (MH) is multi-human. We can see that lift does really well in general. It is perfect for HUMAN demonstrations. However, it is much worse for machine-generated (MG). Either way, we should expect high performance in our task. </i></p> <p>The observation that (PH) and (MH) does better than (MG) is actually stated in the paper in their <b> C1 </b> remark. These (C#) remarks are claims they wish to validate.</p> <blockquote> <p><b> (C1) Data from Non-Markovian Decision Process. </b> Human demonstrations can differ substantially from machine-generated demonstrations because humans may not act purely based on a single current observation. External factors (teleoperation device, past actions, history of episode) may all play a role. Prior work [20] has noted substantial benefits from leveraging models that are history-dependent and / or with temporal abstraction to learn from human demonstrations. We investigate various design choices related to such architectures in this study.</p> </blockquote> <p>This would also mean that for (MG) demos, using BC-RNN might not work.</p> <blockquote> <p><b> (C3) Dependence on Dataset Size. </b> Offline policy learning is sensitive to the state and action space coverage in the dataset, and by extension, the size of the dataset itself. In our study, we investigate how dataset sizes affect policy performance. This analysis is useful to understand the value of adding more data – an important consideration since collecting human demonstrations can be costly.</p> </blockquote> <blockquote> <p><b> (C4) Mismatch between Training and Evaluation Objectives. </b> Unlike traditional supervised learning, where model selection can be achieved by using the model with the lowest validation loss [21], offline policy learning often suffers from the fact that the training objective is only a surrogate for the true objective of interest (e.g. task success rate), and policy performance can change significantly from epoch to epoch. This makes it difficult to select the best trained model [19, 28, 29]. In our study, we evaluate each policy checkpoint online in the environment in simulation, and report the best policy success rate per training run. We use these ground-truth values to understand the effectiveness of different selection criteria, and confirm that offline policy selection is an important problem, especially in real-world scenarios where large-scale empirical evaluation is difficult.</p> </blockquote> <p><b> IMPORTANT BIG NOTE </b> (MG) is generated by running a SOTA RL Policy (from 2021) on these tasks. These literally take in one observation horizon and output an action. We should not trust the (MG) results on scripted demos.</p> <p><img src="../../assets/images/code/lift/robomimic-bc-rnn-study.png" alt="" /></p> <p>These figures don’t need much explaning. It just shows how different hyperparameter settings can change the policy’s performance (mostly for the worse here).</p> <p>Now we move into the appendix section of the paper because that is where the juicy pre-code details are.</p> <h4 id="appendix-info"> <a href="#appendix-info" class="anchor-heading" aria-labelledby="appendix-info"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Appendix Info </h4> <p>Policy outputs actions at a rate of 20Hz. Action space is in delta-pose form. Delta-rotation is axis-angle.</p> <blockquote> <p><b> Lift. </b> Object observations (10-dim) consist of the absolute cube position and cube quaternion (7-dim), and the cube position relative to the robot end effector (3-dim). The cube pose is randomized at the start of each episode with a random z-rotation in a small square region at the center of the table.</p> </blockquote> <p><b> Simulation Note: </b> All tasks were designed using MuJoCo and the robosuite framework.</p> <p>All of the simulation code is actually from robosuite codebase which wraps MuJoCo.</p> <p>The action horizon was 1 by the way.</p><hr /> <h2 id="robomimic-code-dive"> <a href="#robomimic-code-dive" class="anchor-heading" aria-labelledby="robomimic-code-dive"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Robomimic Code Dive </h2> <p>We start in <i> policy_nets.py </i></p> <h3 id="policy-network"> <a href="#policy-network" class="anchor-heading" aria-labelledby="policy-network"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Policy Network </h3> <p>Our desired BC network implementation is written in <i> ActorNetwork </i> class. This is the inheritance graph for the class:</p><pre><code class="language-mermaid">flowchart LR
    A(ActorNetwork) --&gt; B(MIMO_MLP) --&gt; C(Module) --&gt; D(torch.nn.Module)
</code></pre><p>Here is my notes of the <b> implementation of ActorNetwork </b> where I remove some code and comments for clarity.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ActorNetwork</span><span class="p">(</span><span class="n">MIMO_MLP</span><span class="p">):</span>
    <span class="s">"""
    A basic policy network that predicts actions from observations.
    Can optionally be goal conditioned on future observations.
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_shapes</span><span class="p">,</span> <span class="n">ac_dim</span><span class="p">,</span> <span class="n">mlp_layer_dims</span><span class="p">,</span> <span class="n">goal_shapes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">encoder_kwargs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">''' AN NOTE:
        obs_shapes: OrderedDict(string, OrderedDict(string, tuple(int)))
            - string: observation key ('obs' or 'goal')
            - OrderedDict(string, tuple(int))
                - string: observation name ('object', 'eef_quat', 'eef_pos')
                - tuple(int): shape of observation (e.g. (3,), (7,), (10,))
        ac_dim: (int) action dim
        mlp_layer_dims ([int]): specify mlp layers
        '''</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs_shapes</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">obs_shapes</span> <span class="o">=</span> <span class="n">obs_shapes</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">ac_dim</span> <span class="o">=</span> <span class="n">ac_dim</span>

        <span class="n">observation_group_shapes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">observation_group_shapes</span><span class="p">[</span><span class="s">"obs"</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">obs_shapes</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">_is_goal_conditioned</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">goal_shapes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">goal_shapes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">goal_shapes</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_is_goal_conditioned</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">goal_shapes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">goal_shapes</span><span class="p">)</span>
            <span class="n">observation_group_shapes</span><span class="p">[</span><span class="s">"goal"</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">goal_shapes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">goal_shapes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="n">output_shapes</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_get_output_shapes</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ActorNetwork</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">input_obs_group_shapes</span><span class="o">=</span><span class="n">observation_group_shapes</span><span class="p">,</span>
            <span class="n">output_shapes</span><span class="o">=</span><span class="n">output_shapes</span><span class="p">,</span>
            <span class="n">layer_dims</span><span class="o">=</span><span class="n">mlp_layer_dims</span><span class="p">,</span>
            <span class="n">encoder_kwargs</span><span class="o">=</span><span class="n">encoder_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">def</span> <span class="nf">_get_output_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">ac_dim</span><span class="p">,))</span> <span class="c1">#AN NOTE: only output is action dim (horizon=1)
</span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_dict</span><span class="p">,</span> <span class="n">goal_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1"># AN NOTE: actions calls forward from MIMO_MLP
</span>        <span class="n">actions</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ActorNetwork</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">forward</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="n">obs_dict</span><span class="p">,</span> <span class="n">goal</span><span class="o">=</span><span class="n">goal_dict</span><span class="p">)[</span><span class="s">"action"</span><span class="p">]</span>
        <span class="c1"># apply tanh squashing to ensure actions are in [-1, 1]
</span>        <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span> <span class="c1">#AN NOTE: why does it run tanh here?
</span></code></pre></div></div> <p>For the most part, everything makes sense (and maybe too much is abstracted.)</p> <p>I think I don’t quite get why <i> torch.tanh(actions) </i> is such a good idea. While it squashes actions down to [-1, 1], it ‘s a nonlinear mapping. I guess if the network can learn anything, the tanh just serves to restrict the action space.</p> <p>Now we move to the <b> implementation of MIMO_MLP </b>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MIMO_MLP</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="s">"""
    Extension to MLP to accept multiple observation dictionaries as input and
    to output dictionaries of tensors. Inputs are specified as a dictionary of 
    observation dictionaries, with each key corresponding to an observation group.

    This module utilizes @ObservationGroupEncoder to process the multiple input dictionaries and

    @ObservationDecoder to generate tensor dictionaries. The default behavior
    for encoding the inputs is to process visual inputs with a learned CNN and concatenating
    the flat encodings with the other flat inputs. The default behavior for generating 
    outputs is to use a linear layer branch to produce each modality separately
    (including visual outputs).
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_obs_group_shapes</span><span class="p">,</span>
        <span class="n">output_shapes</span><span class="p">,</span>
        <span class="n">layer_dims</span><span class="p">,</span>
        <span class="n">layer_func</span><span class="o">=</span><span class="n">nn</span><span class="p">.</span><span class="n">Linear</span><span class="p">,</span> 
        <span class="n">activation</span><span class="o">=</span><span class="n">nn</span><span class="p">.</span><span class="n">ReLU</span><span class="p">,</span>
        <span class="n">encoder_kwargs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="s">"""
        Args:
            input_obs_group_shapes (OrderedDict): a dictionary of dictionaries.
                Each key in this dictionary should specify an observation group, and
                the value should be an OrderedDict that maps modalities to
                expected shapes.
            output_shapes (OrderedDict): a dictionary that maps modality to
                expected shapes for outputs.
            layer_dims ([int]): sequence of integers for the MLP hidden layer sizes
            layer_func: mapping per MLP layer - defaults to Linear
            activation: non-linearity per MLP layer - defaults to ReLU
        """</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MIMO_MLP</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">input_obs_group_shapes</span> <span class="o">=</span> <span class="n">input_obs_group_shapes</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">output_shapes</span> <span class="o">=</span> <span class="n">output_shapes</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">nets</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">ModuleDict</span><span class="p">()</span>
        <span class="c1"># Encoder for all observation groups.
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">nets</span><span class="p">[</span><span class="s">"encoder"</span><span class="p">]</span> <span class="o">=</span> <span class="n">ObservationGroupEncoder</span><span class="p">(</span>
            <span class="n">observation_group_shapes</span><span class="o">=</span><span class="n">input_obs_group_shapes</span><span class="p">,</span>
            <span class="n">encoder_kwargs</span><span class="o">=</span><span class="n">encoder_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># flat encoder output dimension
</span>        <span class="n">mlp_input_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">nets</span><span class="p">[</span><span class="s">"encoder"</span><span class="p">].</span><span class="n">output_shape</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># intermediate MLP layers
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">nets</span><span class="p">[</span><span class="s">"mlp"</span><span class="p">]</span> <span class="o">=</span> <span class="n">MLP</span><span class="p">(</span>
            <span class="n">input_dim</span><span class="o">=</span><span class="n">mlp_input_dim</span><span class="p">,</span>
            <span class="n">output_dim</span><span class="o">=</span><span class="n">layer_dims</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">layer_dims</span><span class="o">=</span><span class="n">layer_dims</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">layer_func</span><span class="o">=</span><span class="n">layer_func</span><span class="p">,</span>
            <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
            <span class="n">output_activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span> <span class="c1"># make sure non-linearity is applied before decoder
</span>        <span class="p">)</span>
        <span class="c1"># decoder for output modalities
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">nets</span><span class="p">[</span><span class="s">"decoder"</span><span class="p">]</span> <span class="o">=</span> <span class="n">ObservationDecoder</span><span class="p">(</span>
            <span class="n">decode_shapes</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">output_shapes</span><span class="p">,</span>
            <span class="n">input_feat_dim</span><span class="o">=</span><span class="n">layer_dims</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">output_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span> <span class="n">k</span> <span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">output_shapes</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">output_shapes</span> <span class="p">}</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">):</span>
        <span class="n">enc_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">nets</span><span class="p">[</span><span class="s">"encoder"</span><span class="p">](</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="n">mlp_out</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">nets</span><span class="p">[</span><span class="s">"mlp"</span><span class="p">](</span><span class="n">enc_outputs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">nets</span><span class="p">[</span><span class="s">"decoder"</span><span class="p">](</span><span class="n">mlp_out</span><span class="p">)</span>
</code></pre></div></div> <p>Based on this code, the BC network looks like this:</p><pre><code class="language-mermaid">flowchart TD
    A(eef) --&gt; D[\Encoder Head/]
    B(gripper) --&gt; E[\Encoder Head/]
    C(object) --&gt; F[\Encoder Head/]
    D --&gt; G[Concat]
    E --&gt; G[Concat]
    F --&gt; G[Concat]
    G --&gt; H[MLP with ReLU]
    H --&gt; I[/Decoder Head\]
    I --&gt; J[Action]
</code></pre><p>For the decode head it runs an <i> nn.Linear </i> from the output of the MLP to the action space. Not going to include <i> ObservationDecoder </i> because of my summary.</p> <p>Actualy it could just be concatenation for state-based BC. It only runs encoder head for RGB observations (see <i> create_obs_encoder </i>).</p> <p><b> NOTE </b> The difference between this and mine is that I concatenate the observations beforehand (no encoder heads).</p> <h3 id="trainingsim-details-action-space"> <a href="#trainingsim-details-action-space" class="anchor-heading" aria-labelledby="trainingsim-details-action-space"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Training/Sim Details (Action Space) </h3> <p>I think we dug enough into how the <i> ActorNetwork </i> is implemented for us. Now we want to see how it is used in the training loop (and inference time).</p> <p>This is the loss function computed in the <i> BC &lt;/b&gt; class which uses <i> ActorNetwork </i>.</i></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">_compute_losses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
        <span class="s">"""
        Internal helper function for BC algo class. Compute losses based on
        network outputs in @predictions dict, using reference labels in @batch.

        Args:
            predictions (dict): dictionary containing network outputs, from @_forward_training
            batch (dict): dictionary with torch.Tensors sampled
                from a data loader and filtered by @process_batch_for_training

        Returns:
            losses (dict): dictionary of losses computed over the batch
        """</span>
        <span class="n">losses</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">a_target</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s">"actions"</span><span class="p">]</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[</span><span class="s">"actions"</span><span class="p">]</span>
        <span class="n">losses</span><span class="p">[</span><span class="s">"l2_loss"</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="n">actions</span><span class="p">,</span> <span class="n">a_target</span><span class="p">)</span>
        <span class="n">losses</span><span class="p">[</span><span class="s">"l1_loss"</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">SmoothL1Loss</span><span class="p">()(</span><span class="n">actions</span><span class="p">,</span> <span class="n">a_target</span><span class="p">)</span>
        <span class="c1"># cosine direction loss on eef delta position
</span>        <span class="n">losses</span><span class="p">[</span><span class="s">"cos_loss"</span><span class="p">]</span> <span class="o">=</span> <span class="n">LossUtils</span><span class="p">.</span><span class="n">cosine_loss</span><span class="p">(</span><span class="n">actions</span><span class="p">[...,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">a_target</span><span class="p">[...,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span>

        <span class="n">action_losses</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">algo_config</span><span class="p">.</span><span class="n">loss</span><span class="p">.</span><span class="n">l2_weight</span> <span class="o">*</span> <span class="n">losses</span><span class="p">[</span><span class="s">"l2_loss"</span><span class="p">],</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">algo_config</span><span class="p">.</span><span class="n">loss</span><span class="p">.</span><span class="n">l1_weight</span> <span class="o">*</span> <span class="n">losses</span><span class="p">[</span><span class="s">"l1_loss"</span><span class="p">],</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">algo_config</span><span class="p">.</span><span class="n">loss</span><span class="p">.</span><span class="n">cos_weight</span> <span class="o">*</span> <span class="n">losses</span><span class="p">[</span><span class="s">"cos_loss"</span><span class="p">],</span>
        <span class="p">]</span>
        <span class="n">action_loss</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">action_losses</span><span class="p">)</span>
        <span class="n">losses</span><span class="p">[</span><span class="s">"action_loss"</span><span class="p">]</span> <span class="o">=</span> <span class="n">action_loss</span>
        <span class="k">return</span> <span class="n">losses</span>
</code></pre></div></div> <p>As we can see, the loss function is as follows:</p> \[\begin{equation} \mathcal{L} = \lambda_1 \mathcal{L}_{l2} + \lambda_2 \mathcal{L}_{l1} + \lambda_3 \mathcal{L}_{cos} \end{equation}\] <p>where \(\mathcal{L}_{cos}\) is cosine similarity loss. This is added on top of the MSE (I am only using this) and L1 loss.</p> <p>If we tried to figure out how the neural network action is used, we won’t find it in this codebase (sadly). It is all abstracted away in a <i> .step() </i> function within <i> run_rollout() </i> which is where the <i> BC </i> class is deployed. The notion of action is just a tensor that is passed around.</p> <p>In order to understand how the action is used, we need to dig into robosuite, to see how it handles its action space!</p><hr /> <h2 id="robosuite-code-dive"> <a href="#robosuite-code-dive" class="anchor-heading" aria-labelledby="robosuite-code-dive"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Robosuite Code Dive </h2> <p><a href="https://github.com/ARISE-Initiative/robosuite">Robosuite Codebase</a></p> <p>It seems that robosuite has a Lift Task! It is actually a manipulation environment that we can take a look at.</p> <p><b> NOTE </b> if we want to just use someone else’s environment, keep note that robosuite is the codebase that defines all the environments we are benchmarking against. It is a wrapper around MuJoCo.</p> <p>This is the inheritance graph for <i> Lift </i> class:</p><pre><code class="language-mermaid">flowchart LR
    A(Lift) --&gt; B(ManipulationEnv) --&gt; C(RobotEnv) --&gt; D(MujocoEnv)
</code></pre><p>It seems all of the details of how action is handled is within the <i> RobotEnv </i> class.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">_pre_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">policy_step</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="s">"""
        Overrides the superclass method to control the robot(s) within this enviornment using their respective
        controllers using the passed actions and gripper control.

        Args:
            action (np.array): The control to apply to the robot(s). Note that this should be a flat 1D array that
                encompasses all actions to be distributed to each robot if there are multiple. For each section of the
                action space assigned to a single robot, the first @self.robots[i].controller.control_dim dimensions
                should be the desired controller actions and if the robot has a gripper, the next
                @self.robots[i].gripper.dof dimensions should be actuation controls for the gripper.
            policy_step (bool): Whether a new policy step (action) is being taken

        Raises:
            AssertionError: [Invalid action dimension]
        """</span>
        <span class="c1"># Verify that the action is the correct dimension
</span>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="p">.</span><span class="n">action_dim</span><span class="p">,</span> <span class="s">"environment got invalid action dimension -- expected {}, got {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">action_dim</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Update robot joints based on controller actions
</span>        <span class="n">cutoff</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">robot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">robots</span><span class="p">):</span>
            <span class="n">robot_action</span> <span class="o">=</span> <span class="n">action</span><span class="p">[</span><span class="n">cutoff</span> <span class="p">:</span> <span class="n">cutoff</span> <span class="o">+</span> <span class="n">robot</span><span class="p">.</span><span class="n">action_dim</span><span class="p">]</span>
            <span class="n">robot</span><span class="p">.</span><span class="n">control</span><span class="p">(</span><span class="n">robot_action</span><span class="p">,</span> <span class="n">policy_step</span><span class="o">=</span><span class="n">policy_step</span><span class="p">)</span>
            <span class="n">cutoff</span> <span class="o">+=</span> <span class="n">robot</span><span class="p">.</span><span class="n">action_dim</span>
</code></pre></div></div> <p>I don’t know what this pre-action is but it seems that it could be overriding the controller???? and just setting the robot position.</p> <p>According to <i> robosuite/environments/base.py </i> line 483 in the definition of <i> _pre_action </i>:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">_pre_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">policy_step</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="s">"""
    Do any preprocessing before taking an action.
    Args:
        action (np.array): Action to execute within the environment
        policy_step (bool): Whether this current loop is an actual policy step or internal sim update step
    """</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">sim</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">ctrl</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">action</span>
</code></pre></div></div> <p>which means that this code does get run and will change the robot!</p> <p>Note that the robot state change comes from <i> robot.control </i>, so we can investigate that.</p> <p>We find an implementation of <i> control </i> in <i> robosuite/robots/fixed_base_robots.py </i></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">policy_step</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="s">"""
    Actuate the robot with the
    passed joint velocities and gripper control.

    Args:
        action (np.array): The control to apply to the robot. The first @self.robot_model.dof dimensions should
            be the desired normalized joint velocities and if the robot has a gripper, the next @self.gripper.dof
            dimensions should be actuation controls for the gripper.

            :NOTE: Assumes inputted actions are of form:
                [right_arm_control, right_gripper_control, left_arm_control, left_gripper_control]

        policy_step (bool): Whether a new policy step (action) is being taken
    """</span>
    <span class="c1"># clip actions into valid range
</span>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="p">.</span><span class="n">action_dim</span><span class="p">,</span> <span class="s">"environment got invalid action dimension -- expected {}, got {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">action_dim</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="p">.</span><span class="n">composite_controller</span><span class="p">.</span><span class="n">update_state</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">policy_step</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">composite_controller</span><span class="p">.</span><span class="n">set_goal</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="n">applied_action_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">composite_controller</span><span class="p">.</span><span class="n">run_controller</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">_enabled_parts</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">part_name</span><span class="p">,</span> <span class="n">applied_action</span> <span class="ow">in</span> <span class="n">applied_action_dict</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">applied_action_low</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sim</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">actuator_ctrlrange</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">_ref_actuators_indexes_dict</span><span class="p">[</span><span class="n">part_name</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">applied_action_high</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sim</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">actuator_ctrlrange</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">_ref_actuators_indexes_dict</span><span class="p">[</span><span class="n">part_name</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">applied_action</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">applied_action</span><span class="p">,</span> <span class="n">applied_action_low</span><span class="p">,</span> <span class="n">applied_action_high</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sim</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">ctrl</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">_ref_actuators_indexes_dict</span><span class="p">[</span><span class="n">part_name</span><span class="p">]]</span> <span class="o">=</span> <span class="n">applied_action</span>

    <span class="k">if</span> <span class="n">policy_step</span><span class="p">:</span>
        <span class="c1"># Update proprioceptive values
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">recent_qpos</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">_joint_positions</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">recent_actions</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">recent_torques</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">torques</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">arm</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">arms</span><span class="p">:</span>
            <span class="n">controller</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">part_controllers</span><span class="p">[</span><span class="n">arm</span><span class="p">]</span>
            <span class="c1"># Update arm-specific proprioceptive values
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">recent_ee_forcetorques</span><span class="p">[</span><span class="n">arm</span><span class="p">].</span><span class="n">push</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="p">.</span><span class="n">ee_force</span><span class="p">[</span><span class="n">arm</span><span class="p">],</span> <span class="bp">self</span><span class="p">.</span><span class="n">ee_torque</span><span class="p">[</span><span class="n">arm</span><span class="p">])))</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">recent_ee_pose</span><span class="p">[</span><span class="n">arm</span><span class="p">].</span><span class="n">push</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">controller</span><span class="p">.</span><span class="n">ref_pos</span><span class="p">,</span> <span class="n">T</span><span class="p">.</span><span class="n">mat2quat</span><span class="p">(</span><span class="n">controller</span><span class="p">.</span><span class="n">ref_ori_mat</span><span class="p">))))</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">recent_ee_vel</span><span class="p">[</span><span class="n">arm</span><span class="p">].</span><span class="n">push</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">controller</span><span class="p">.</span><span class="n">ref_pos_vel</span><span class="p">,</span> <span class="n">controller</span><span class="p">.</span><span class="n">ref_ori_vel</span><span class="p">)))</span>

            <span class="c1"># Estimation of eef acceleration (averaged derivative of recent velocities)
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">recent_ee_vel_buffer</span><span class="p">[</span><span class="n">arm</span><span class="p">].</span><span class="n">push</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">controller</span><span class="p">.</span><span class="n">ref_pos_vel</span><span class="p">,</span> <span class="n">controller</span><span class="p">.</span><span class="n">ref_ori_vel</span><span class="p">)))</span>
            <span class="n">diffs</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">vstack</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">recent_ee_acc</span><span class="p">[</span><span class="n">arm</span><span class="p">].</span><span class="n">current</span><span class="p">,</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">control_freq</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">recent_ee_vel_buffer</span><span class="p">[</span><span class="n">arm</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">ee_acc</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">"valid"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">diffs</span><span class="p">.</span><span class="n">transpose</span><span class="p">()])</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">recent_ee_acc</span><span class="p">[</span><span class="n">arm</span><span class="p">].</span><span class="n">push</span><span class="p">(</span><span class="n">ee_acc</span><span class="p">)</span>
</code></pre></div></div> <p>We see that this actually runs a controller (most likely OSC) and then gives out an “action” which is actually just torques to apply on the robot.</p> <p>So in reality, the <i> _pre_action </i> is the action code.</p> <p>Now, we can take a look at the controller code. This is located in <i> robosuite/controllers/parts/arm/osc.py </i>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">set_goal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="s">"""
    Sets goal based on input @action. If self.impedance_mode is not "fixed", then the input will be parsed into the
    delta values to update the goal position / pose and the kp and/or damping_ratio values to be immediately updated
    internally before executing the proceeding control loop.

    Note that @action expected to be in the following format, based on impedance mode!

        :Mode `'fixed'`: [joint pos command]
        :Mode `'variable'`: [damping_ratio values, kp values, joint pos command]
        :Mode `'variable_kp'`: [kp values, joint pos command]

    Args:
        action (Iterable): Desired relative joint position goal state
    """</span>
    <span class="c1"># Update state
</span>    <span class="bp">self</span><span class="p">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># Parse action based on the impedance mode, and update kp / kd as necessary
</span>    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">impedance_mode</span> <span class="o">==</span> <span class="s">"variable"</span><span class="p">:</span>
        <span class="n">damping_ratio</span><span class="p">,</span> <span class="n">kp</span><span class="p">,</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">action</span><span class="p">[:</span><span class="mi">6</span><span class="p">],</span> <span class="n">action</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">12</span><span class="p">],</span> <span class="n">action</span><span class="p">[</span><span class="mi">12</span><span class="p">:]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">kp</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">kp</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">kp_min</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">kp_max</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">kd</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">kp</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">damping_ratio</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">damping_ratio_min</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">damping_ratio_max</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="p">.</span><span class="n">impedance_mode</span> <span class="o">==</span> <span class="s">"variable_kp"</span><span class="p">:</span>
        <span class="n">kp</span><span class="p">,</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">action</span><span class="p">[:</span><span class="mi">6</span><span class="p">],</span> <span class="n">action</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">kp</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">kp</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">kp_min</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">kp_max</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">kd</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">kp</span><span class="p">)</span>  <span class="c1"># critically damped
</span>    <span class="k">else</span><span class="p">:</span>  <span class="c1"># This is case "fixed"
</span>        <span class="n">delta</span> <span class="o">=</span> <span class="n">action</span>

    <span class="c1"># If we're using deltas, interpret actions as such
</span>    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">input_type</span> <span class="o">==</span> <span class="s">"delta"</span><span class="p">:</span>
        <span class="n">scaled_delta</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">scale_action</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">goal_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">compute_goal_pos</span><span class="p">(</span><span class="n">scaled_delta</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">use_ori</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">goal_ori</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">compute_goal_ori</span><span class="p">(</span><span class="n">scaled_delta</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">goal_ori</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">compute_goal_ori</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="c1"># Else, interpret actions as absolute values
</span>    <span class="k">elif</span> <span class="bp">self</span><span class="p">.</span><span class="n">input_type</span> <span class="o">==</span> <span class="s">"absolute"</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">goal_pos</span> <span class="o">=</span> <span class="n">action</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">use_ori</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">goal_ori</span> <span class="o">=</span> <span class="n">Rotation</span><span class="p">.</span><span class="n">from_rotvec</span><span class="p">(</span><span class="n">action</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]).</span><span class="n">as_matrix</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">goal_ori</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">compute_goal_ori</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s">"Unsupport input_type </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">input_type</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="p">...</span> <span class="c1"># AN CUTOFF
</span></code></pre></div></div> <p>We can see that when <i> input_type == “delta” </i>, it computes the new rotation matrix given a delta rather than just wrap a rotation instance around the action.</p> <p>If we really want to get specific, we can look at <i> self.compute_goal_ori </i></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">compute_goal_ori</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">goal_update_mode</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""
        Compute new goal orientation, given a delta to update. Can either update the new goal based on
        current achieved position or current deisred goal. Updating based on current deisred goal can be useful
        if we want the robot to adhere with a sequence of target poses as closely as possible,
        without lagging or overshooting.

        Args:
            delta (np.array): Desired relative change in orientation, in axis-angle form [ax, ay, az]
            goal_update_mode (str): either "achieved" (achieved position) or "desired" (desired goal)

        Returns:
            np.array: updated goal orientation in the controller frame
        """</span>
        <span class="k">if</span> <span class="n">goal_update_mode</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">goal_update_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_goal_update_mode</span>
        <span class="k">assert</span> <span class="n">goal_update_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"achieved"</span><span class="p">,</span> <span class="s">"desired"</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">goal_ori</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># if goal is not already set, set it to current orientation (in controller ref frame)
</span>            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">input_ref_frame</span> <span class="o">==</span> <span class="s">"base"</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">goal_ori</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">goal_origin_to_eef_pose</span><span class="p">()[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="p">.</span><span class="n">input_ref_frame</span> <span class="o">==</span> <span class="s">"world"</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">goal_ori</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">ref_ori_mat</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nb">ValueError</span>

        <span class="c1"># convert axis-angle value to rotation matrix
</span>        <span class="n">quat_error</span> <span class="o">=</span> <span class="n">T</span><span class="p">.</span><span class="n">axisangle2quat</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="c1">#AN NOTE: this is the moneymaker
</span>        <span class="n">rotation_mat_error</span> <span class="o">=</span> <span class="n">T</span><span class="p">.</span><span class="n">quat2mat</span><span class="p">(</span><span class="n">quat_error</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">_goal_update_mode</span> <span class="o">==</span> <span class="s">"desired"</span><span class="p">:</span>
            <span class="c1"># update new goal wrt current desired goal
</span>            <span class="n">goal_ori</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotation_mat_error</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">goal_ori</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="p">.</span><span class="n">_goal_update_mode</span> <span class="o">==</span> <span class="s">"achieved"</span><span class="p">:</span>
            <span class="c1"># update new goal wrt current achieved orientation
</span>            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">input_ref_frame</span> <span class="o">==</span> <span class="s">"base"</span><span class="p">:</span>
                <span class="n">curr_goal_ori</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">goal_origin_to_eef_pose</span><span class="p">()[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="p">.</span><span class="n">input_ref_frame</span> <span class="o">==</span> <span class="s">"world"</span><span class="p">:</span>
                <span class="n">curr_goal_ori</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">ref_ori_mat</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nb">ValueError</span>
            <span class="n">goal_ori</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotation_mat_error</span><span class="p">,</span> <span class="n">curr_goal_ori</span><span class="p">)</span> <span class="c1">#AN NOTE: this is the moneymaker
</span>        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span>

        <span class="c1"># AN REDACTED
</span>
        <span class="k">return</span> <span class="n">goal_ori</span>
</code></pre></div></div> <p>We can see in the definition of <i> goal_ori </i> how delta is utilized. Additionally, we know that the delta is angleaxis representation in the instantiation of <i> quat_error </i> where it uses <i> T.axisangle2quat(delta) </i> to convert it from axisangle to a quaternion.</p> <p>This confirms that the action space is in delta-poses and uses axis-angle for rotation representation.</p><hr /> <h3 id="checking-out-robomimics-dataset"> <a href="#checking-out-robomimics-dataset" class="anchor-heading" aria-labelledby="checking-out-robomimics-dataset"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Checking out Robomimic’s dataset </h3> <p>Next implementation detail that we need to understand is how the dataset is recorded.</p> </main> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">By An Dang.</p> <div class="d-flex mt-2"> <p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/dangthanhan507/dangthanhan507.github.io/blob/master/code-notes/benchmark-notes/robomimic.md" id="edit-this-page">Edit this page on GitHub.</a> </p> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> <script type="module"> import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.esm.min.mjs'; var config = {} ; mermaid.initialize(config); mermaid.run({ querySelector: '.language-mermaid', }); </script> </body> </html>
